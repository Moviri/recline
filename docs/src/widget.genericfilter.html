<!DOCTYPE html>  <html> <head>   <title>widget.genericfilter.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="action.html">                 action.js               </a>                                           <a class="source" href="backend.ckan.html">                 backend.ckan.js               </a>                                           <a class="source" href="backend.couchdb.html">                 backend.couchdb.js               </a>                                           <a class="source" href="backend.csv.html">                 backend.csv.js               </a>                                           <a class="source" href="backend.dataproxy.html">                 backend.dataproxy.js               </a>                                           <a class="source" href="backend.elasticsearch.html">                 backend.elasticsearch.js               </a>                                           <a class="source" href="backend.gdocs.html">                 backend.gdocs.js               </a>                                           <a class="source" href="backend.jsonp.html">                 backend.jsonp.js               </a>                                           <a class="source" href="backend.memory.html">                 backend.memory.js               </a>                                           <a class="source" href="backend.solr.html">                 backend.solr.js               </a>                                           <a class="source" href="data.aggregations.html">                 data.aggregations.js               </a>                                           <a class="source" href="data.colors.html">                 data.colors.js               </a>                                           <a class="source" href="data.faceting.html">                 data.faceting.js               </a>                                           <a class="source" href="data.fieldsutilities.html">                 data.fieldsutilities.js               </a>                                           <a class="source" href="data.filters.html">                 data.filters.js               </a>                                           <a class="source" href="data.formatters.html">                 data.formatters.js               </a>                                           <a class="source" href="data.shapes.html">                 data.shapes.js               </a>                                           <a class="source" href="data.statemanagement.html">                 data.statemanagement.js               </a>                                           <a class="source" href="data.transform.html">                 data.transform.js               </a>                                           <a class="source" href="ecma-fixes.html">                 ecma-fixes.js               </a>                                           <a class="source" href="model.html">                 model.js               </a>                                           <a class="source" href="template.shapes.html">                 template.shapes.js               </a>                                           <a class="source" href="view.composed.html">                 view.composed.js               </a>                                           <a class="source" href="view.graph.html">                 view.graph.js               </a>                                           <a class="source" href="view.grid.html">                 view.grid.js               </a>                                           <a class="source" href="view.indicator.html">                 view.indicator.js               </a>                                           <a class="source" href="view.kartograph.html">                 view.kartograph.js               </a>                                           <a class="source" href="view.map.html">                 view.map.js               </a>                                           <a class="source" href="view.multiview.html">                 view.multiview.js               </a>                                           <a class="source" href="view.nvd3.graph.html">                 view.nvd3.graph.js               </a>                                           <a class="source" href="view.rickshaw.html">                 view.rickshaw.js               </a>                                           <a class="source" href="view.slickgrid.html">                 view.slickgrid.js               </a>                                           <a class="source" href="view.timeline.html">                 view.timeline.js               </a>                                           <a class="source" href="view.transform.html">                 view.transform.js               </a>                                           <a class="source" href="widget.currentfilter.html">                 widget.currentfilter.js               </a>                                           <a class="source" href="widget.datepicker.html">                 widget.datepicker.js               </a>                                           <a class="source" href="widget.facetviewer.html">                 widget.facetviewer.js               </a>                                           <a class="source" href="widget.fields.html">                 widget.fields.js               </a>                                           <a class="source" href="widget.filtereditor.html">                 widget.filtereditor.js               </a>                                           <a class="source" href="widget.genericfilter.html">                 widget.genericfilter.js               </a>                                           <a class="source" href="widget.pager.html">                 widget.pager.js               </a>                                           <a class="source" href="widget.queryeditor.html">                 widget.queryeditor.js               </a>                                           <a class="source" href="widget.visualsearch.html">                 widget.visualsearch.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               widget.genericfilter.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*jshint multistr:true */</span>
<span class="k">this</span><span class="p">.</span><span class="nx">recline</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">recline</span> <span class="o">||</span> <span class="p">{};</span>
<span class="k">this</span><span class="p">.</span><span class="nx">recline</span><span class="p">.</span><span class="nx">View</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">recline</span><span class="p">.</span><span class="nx">View</span> <span class="o">||</span> <span class="p">{};</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">my</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">my</span><span class="p">.</span><span class="nx">GenericFilter</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">className</span><span class="o">:</span><span class="s1">&#39;recline-filter-editor well&#39;</span><span class="p">,</span>
        <span class="nx">template</span><span class="o">:</span><span class="s1">&#39;&lt;div class=&quot;filters&quot; style=&quot;background-color:{{backgroundColor}}&quot;&gt; \</span>
<span class="s1">      &lt;div class=&quot;form-stacked js-edit&quot;&gt; \</span>
<span class="s1">      &lt;div class=&quot;label label-info&quot; style=&quot;display:{{titlePresent}}&quot; &gt; \</span>
<span class="s1">        &lt;h4&gt;{{filterDialogTitle}}&lt;/h4&gt; \</span>
<span class="s1">        {{filterDialogDescription}} \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">        {{#filters}} \</span>
<span class="s1">          {{{filterRender}}} \</span>
<span class="s1">      &lt;hr style=&quot;display:{{hrVisible}}&quot;&gt; \</span>
<span class="s1">        {{/filters}} \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &lt;/div&gt;&#39;</span><span class="p">,</span>
        <span class="nx">templateHoriz</span><span class="o">:</span><span class="s1">&#39;&lt;style&gt; .separated-item { padding-left:20px;padding-right:20px; } &lt;/style&gt; &lt;div class=&quot;filters&quot; style=&quot;background-color:{{backgroundColor}}&quot;&gt; \</span>
<span class="s1">      &lt;table &gt; \</span>
<span class="s1">      &lt;tbody&gt; \</span>
<span class="s1">        &lt;tr&gt;\</span>
<span class="s1">          &lt;td class=&quot;separated-item&quot; style=&quot;display:{{titlePresent}}&quot;&gt;\</span>
<span class="s1">            &lt;div class=&quot;label label-info&quot;&gt; \</span>
<span class="s1">              &lt;h4&gt;{{filterDialogTitle}}&lt;/h4&gt; \</span>
<span class="s1">              {{filterDialogDescription}} \</span>
<span class="s1">            &lt;/div&gt; \</span>
<span class="s1">        &lt;/td&gt;\</span>
<span class="s1">          {{#filters}} \</span>
<span class="s1">          &lt;td class=&quot;separated-item&quot;&gt;\</span>
<span class="s1">                {{{filterRender}}} \</span>
<span class="s1">              &lt;/td&gt;\</span>
<span class="s1">          {{/filters}} \</span>
<span class="s1">          &lt;/tr&gt;\</span>
<span class="s1">      &lt;/tbody&gt;\</span>
<span class="s1">       &lt;/table&gt; \</span>
<span class="s1">    &lt;/div&gt; &#39;</span><span class="p">,</span>
        <span class="nx">filterTemplates</span><span class="o">:</span><span class="p">{</span>
            <span class="nx">term</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;padding-top:2px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">          &lt;input type=&quot;text&quot; value=&quot;{{term}}&quot; name=&quot;term&quot; class=&quot;data-control-id&quot; /&gt; \</span>
<span class="s1">          &lt;input type=&quot;button&quot; class=&quot;btn&quot; id=&quot;setFilterValueButton&quot; value=&quot;Set&quot;&gt;&lt;/input&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">slider</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">  &lt;script&gt; \</span>
<span class="s1">    $(document).ready(function(){ \</span>
<span class="s1">      $( &quot;#slider{{ctrlId}}&quot; ).slider({ \</span>
<span class="s1">        min: {{min}}, \</span>
<span class="s1">        max: {{max}}, \</span>
<span class="s1">        value: {{term}}, \</span>
<span class="s1">        slide: function( event, ui ) { \</span>
<span class="s1">          $( &quot;#amount{{ctrlId}}&quot; ).html( &quot;{{label}}: &quot;+ ui.value ); \</span>
<span class="s1">        } \</span>
<span class="s1">      }); \</span>
<span class="s1">      $( &quot;#amount{{ctrlId}}&quot; ).html( &quot;{{label}}: &quot;+ $( &quot;#slider{{ctrlId}}&quot; ).slider( &quot;value&quot; ) ); \</span>
<span class="s1">    }); \</span>
<span class="s1">  &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot; style=&quot;min-width:100px&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}} \</span>
<span class="s1">      &lt;a class=&quot;js-remove-filter&quot; href=&quot;#&quot; title=&quot;Remove this filter&quot;&gt;&amp;times;&lt;/a&gt; \</span>
<span class="s1">    &lt;/legend&gt;  \</span>
<span class="s1">      &lt;label id=&quot;amount{{ctrlId}}&quot;&gt;{{label}}: &lt;/label&gt; \</span>
<span class="s1">      &lt;div id=&quot;slider{{ctrlId}}&quot; class=&quot;data-control-id&quot;&gt;&lt;/div&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">          &lt;input type=&quot;button&quot; class=&quot;btn&quot; id=&quot;setFilterValueButton&quot; value=&quot;Set&quot;&gt;&lt;/input&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">slider_styled</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">  &lt;style&gt; \</span>
<span class="s1">     .layout-slider { padding-bottom:15px;width:150px } \</span>
<span class="s1">  &lt;/style&gt; \</span>
<span class="s1">  &lt;script&gt; \</span>
<span class="s1">    $(document).ready(function(){ \</span>
<span class="s1">      $( &quot;#slider{{ctrlId}}&quot; ).jslider({ \</span>
<span class="s1">        from: {{min}}, \</span>
<span class="s1">        to: {{max}}, \</span>
<span class="s1">        scale: [{{min}},&quot;|&quot;,&quot;{{step1}}&quot;,&quot;|&quot;,&quot;{{mean}}&quot;,&quot;|&quot;,&quot;{{step3}}&quot;,&quot;|&quot;,{{max}}], \</span>
<span class="s1">        step: {{step}}, \</span>
<span class="s1">        limits: false, \</span>
<span class="s1">        skin: &quot;plastic&quot; \</span>
<span class="s1">      }); \</span>
<span class="s1">    }); \</span>
<span class="s1">  &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}} \</span>
<span class="s1">      &lt;a class=&quot;js-remove-filter&quot; href=&quot;#&quot; title=&quot;Remove this filter&quot;&gt;&amp;times;&lt;/a&gt; \</span>
<span class="s1">    &lt;/legend&gt;  \</span>
<span class="s1">    &lt;div style=&quot;float:left;padding-right:15px;display:{{useLeftLabel}}&quot;&gt;{{label}} \</span>
<span class="s1">      &lt;a class=&quot;js-remove-filter&quot; href=&quot;#&quot; title=&quot;Remove this filter&quot;&gt;&amp;times;&lt;/a&gt; \</span>
<span class="s1">    &lt;/div&gt; \</span>
<span class="s1">      &lt;div style=&quot;float:left&quot; class=&quot;layout-slider&quot; &gt; \</span>
<span class="s1">        &lt;input type=&quot;slider&quot; id=&quot;slider{{ctrlId}}&quot; value=&quot;{{term}}&quot; class=&quot;slider-styled data-control-id&quot; /&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">range</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">          &lt;label class=&quot;control-label&quot; for=&quot;&quot;&gt;From&lt;/label&gt; \</span>
<span class="s1">          &lt;input type=&quot;text&quot; value=&quot;{{start}}&quot; name=&quot;start&quot;  class=&quot;data-control-id-from&quot; style=&quot;width:auto&quot;/&gt; \</span>
<span class="s1">          &lt;label class=&quot;control-label&quot; for=&quot;&quot;&gt;To&lt;/label&gt; \</span>
<span class="s1">          &lt;input type=&quot;text&quot; value=&quot;{{stop}}&quot; name=&quot;stop&quot; class=&quot;data-control-id-to&quot;  style=&quot;width:auto&quot;/&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">          &lt;input type=&quot;button&quot; class=&quot;btn&quot; id=&quot;setFilterValueButton&quot; value=&quot;Set&quot;&gt;&lt;/input&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">range_slider</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">  &lt;script&gt; \</span>
<span class="s1">    $(document).ready(function(){ \</span>
<span class="s1">      $( &quot;#slider-range{{ctrlId}}&quot; ).slider({ \</span>
<span class="s1">        range: true, \</span>
<span class="s1">        min: {{min}}, \</span>
<span class="s1">        max: {{max}}, \</span>
<span class="s1">        values: [ {{from}}, {{to}} ], \</span>
<span class="s1">        slide: function( event, ui ) { \</span>
<span class="s1">          $( &quot;#amount{{ctrlId}}&quot; ).html(  &quot;{{label}}: &quot; + ui.values[ 0 ] + &quot; - &quot; + ui.values[ 1 ] ); \</span>
<span class="s1">        } \</span>
<span class="s1">      }); \</span>
<span class="s1">      $( &quot;#amount{{ctrlId}}&quot; ).html(  &quot;{{label}}: &quot; + $( &quot;#slider-range{{ctrlId}}&quot; ).slider( &quot;values&quot;, 0 ) + &quot; - &quot; + $( &quot;#slider-range{{ctrlId}}&quot; ).slider( &quot;values&quot;, 1 ) ); \</span>
<span class="s1">    }); \</span>
<span class="s1">  &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot; style=&quot;min-width:100px&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">      &lt;label id=&quot;amount{{ctrlId}}&quot;&gt;{{label}} range: &lt;/label&gt; \</span>
<span class="s1">      &lt;div id=&quot;slider-range{{ctrlId}}&quot; class=&quot;data-control-id&quot; &gt;&lt;/div&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">          &lt;input type=&quot;button&quot; class=&quot;btn&quot; id=&quot;setFilterValueButton&quot; value=&quot;Set&quot;&gt;&lt;/input&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">range_slider_styled</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">  &lt;style&gt; \</span>
<span class="s1">   .layout-slider { padding-bottom:15px;width:150px } \</span>
<span class="s1">  &lt;/style&gt; \</span>
<span class="s1">  &lt;script&gt; \</span>
<span class="s1">    $(document).ready(function(){ \</span>
<span class="s1">      $( &quot;#slider{{ctrlId}}&quot; ).jslider({ \</span>
<span class="s1">        from: {{min}}, \</span>
<span class="s1">        to: {{max}}, \</span>
<span class="s1">        scale: [{{min}},&quot;|&quot;,&quot;{{step1}}&quot;,&quot;|&quot;,&quot;{{mean}}&quot;,&quot;|&quot;,&quot;{{step3}}&quot;,&quot;|&quot;,{{max}}], \</span>
<span class="s1">        limits: false, \</span>
<span class="s1">        step: {{step}}, \</span>
<span class="s1">        skin: &quot;round_plastic&quot;, \</span>
<span class="s1">      }); \</span>
<span class="s1">    }); \</span>
<span class="s1">  &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}} \</span>
<span class="s1">    &lt;/legend&gt;  \</span>
<span class="s1">    &lt;div style=&quot;float:left;padding-right:15px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">      &lt;div style=&quot;float:left&quot; class=&quot;layout-slider&quot; &gt; \</span>
<span class="s1">        &lt;input type=&quot;slider&quot; id=&quot;slider{{ctrlId}}&quot; value=&quot;{{from}};{{to}}&quot; class=&quot;slider-styled data-control-id&quot; /&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">month_week_calendar</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">    &lt;style&gt; \</span>
<span class="s1">    .list-filter-item { cursor:pointer; } \</span>
<span class="s1">    .list-filter-item:hover { background: lightblue;cursor:pointer; } \</span>
<span class="s1">    &lt;/style&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}  \</span>
<span class="s1">            &lt;a class=&quot;js-remove-filter&quot; href=&quot;#&quot; title=&quot;Remove this filter&quot;&gt;&amp;times;&lt;/a&gt; \</span>
<span class="s1">      &lt;/legend&gt; \</span>
<span class="s1">      Year&lt;br&gt; \</span>
<span class="s1">      &lt;select class=&quot;drop-down2 fields data-control-id&quot; &gt; \</span>
<span class="s1">            {{#yearValues}} \</span>
<span class="s1">            &lt;option value=&quot;{{val}}&quot; {{selected}}&gt;{{val}}&lt;/option&gt; \</span>
<span class="s1">            {{/yearValues}} \</span>
<span class="s1">          &lt;/select&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">      Type&lt;br&gt; \</span>
<span class="s1">      &lt;select class=&quot;drop-down3 fields&quot; &gt; \</span>
<span class="s1">        {{#periodValues}} \</span>
<span class="s1">        &lt;option value=&quot;{{val}}&quot; {{selected}}&gt;{{val}}&lt;/option&gt; \</span>
<span class="s1">        {{/periodValues}} \</span>
<span class="s1">      &lt;/select&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">      &lt;div style=&quot;max-height:500px;width:100%;border:1px solid grey;overflow:auto;&quot;&gt; \</span>
<span class="s1">        &lt;table class=&quot;table table-striped table-hover table-condensed&quot; style=&quot;width:100%&quot; data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">        &lt;tbody&gt;\</span>
<span class="s1">        {{#values}} \</span>
<span class="s1">        &lt;tr class=&quot;{{selected}}&quot;&gt;&lt;td class=&quot;list-filter-item &quot; myValue=&quot;{{val}}&quot; startDate=&quot;{{startDate}}&quot; stopDate=&quot;{{stopDate}}&quot;&gt;{{label}}&lt;/td&gt;&lt;/tr&gt; \</span>
<span class="s1">        {{/values}} \</span>
<span class="s1">        &lt;/tbody&gt; \</span>
<span class="s1">        &lt;/table&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">      &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">  &#39;</span><span class="p">,</span>
            <span class="nx">range_calendar</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">  &lt;script&gt; \</span>
<span class="s1">  $(function() { \</span>
<span class="s1">    $( &quot;#from{{ctrlId}}&quot; ).datepicker({ \</span>
<span class="s1">      defaultDate: &quot;{{startDate}}&quot;, \</span>
<span class="s1">      changeMonth: true, \</span>
<span class="s1">      numberOfMonths: 1, \</span>
<span class="s1">      dateFormat: &quot;D M dd yy&quot;, \</span>
<span class="s1">      onSelect: function( selectedDate ) { \</span>
<span class="s1">        $( &quot;#to{{ctrlId}}&quot; ).datepicker( &quot;option&quot;, &quot;minDate&quot;, selectedDate ); \</span>
<span class="s1">      } \</span>
<span class="s1">    }); \</span>
<span class="s1">    $( &quot;#to{{ctrlId}}&quot; ).datepicker({ \</span>
<span class="s1">      defaultDate: &quot;{{endDate}}&quot;, \</span>
<span class="s1">      changeMonth: true, \</span>
<span class="s1">      numberOfMonths: 1, \</span>
<span class="s1">      dateFormat: &quot;D M dd yy&quot;, \</span>
<span class="s1">      onSelect: function( selectedDate ) { \</span>
<span class="s1">        $( &quot;#from{{ctrlId}}&quot; ).datepicker( &quot;option&quot;, &quot;maxDate&quot;, selectedDate ); \</span>
<span class="s1">      } \</span>
<span class="s1">    }); \</span>
<span class="s1">  }); \</span>
<span class="s1">  &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">      &lt;label for=&quot;from{{ctrlId}}&quot;&gt;From&lt;/label&gt; \</span>
<span class="s1">      &lt;input type=&quot;text&quot; id=&quot;from{{ctrlId}}&quot; name=&quot;from{{ctrlId}}&quot; class=&quot;data-control-id-from&quot; value=&quot;{{startDate}}&quot; style=&quot;width:auto&quot;/&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">      &lt;label for=&quot;to{{ctrlId}}&quot;&gt;to&lt;/label&gt; \</span>
<span class="s1">      &lt;input type=&quot;text&quot; id=&quot;to{{ctrlId}}&quot; name=&quot;to{{ctrlId}}&quot; class=&quot;data-control-id-to&quot; value=&quot;{{endDate}}&quot; style=&quot;width:auto&quot;/&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">          &lt;input type=&quot;button&quot; class=&quot;btn&quot; id=&quot;setFilterValueButton&quot; value=&quot;Set&quot;&gt;&lt;/input&gt; \</span>
<span class="s1">       &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">  &#39;</span><span class="p">,</span>
            <span class="nx">dropdown</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">      &lt;script&gt;  \</span>
<span class="s1">      function updateColor(elem) { \</span>
<span class="s1">        if (elem.prop(&quot;selectedIndex&quot;) == 0) elem.addClass(&quot;dimmed&quot;); else elem.removeClass(&quot;dimmed&quot;); \</span>
<span class="s1">      } \</span>
<span class="s1">      &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}} \</span>
<span class="s1">        &lt;/legend&gt;  \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;padding-top:2px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">        &lt;select class=&quot;drop-down fields data-control-id dimmed&quot; onchange=&quot;updateColor($(this))&quot;&gt; \</span>
<span class="s1">      &lt;option class=&quot;dimmedDropDownText&quot;&gt;{{innerLabel}}&lt;/option&gt; \</span>
<span class="s1">            {{#values}} \</span>
<span class="s1">            &lt;option class=&quot;normalDropDownText&quot; value=&quot;{{val}}&quot; {{selected}}&gt;{{valCount}}&lt;/option&gt; \</span>
<span class="s1">            {{/values}} \</span>
<span class="s1">          &lt;/select&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">dropdown_styled</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">      &lt;script&gt; \</span>
<span class="s1">      $(function() { \</span>
<span class="s1">        $(&quot;.chzn-select-deselect&quot;).chosen({allow_single_deselect:true}); \</span>
<span class="s1">      }); \</span>
<span class="s1">      &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">      &lt;div style=&quot;float:left;padding-right:10px;padding-top:3px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">        &lt;select class=&quot;chzn-select-deselect data-control-id&quot; data-placeholder=&quot;{{innerLabel}}&quot;&gt; \</span>
<span class="s1">        &lt;option&gt;&lt;/option&gt; \</span>
<span class="s1">            {{#values}} \</span>
<span class="s1">            &lt;option value=&quot;{{val}}&quot; {{selected}}&gt;{{valCount}}&lt;/option&gt; \</span>
<span class="s1">            {{/values}} \</span>
<span class="s1">          &lt;/select&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">dropdown_date_range</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}} \</span>
<span class="s1">        &lt;/legend&gt;  \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;padding-top:3px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">      &lt;select class=&quot;drop-down fields data-control-id&quot; &gt; \</span>
<span class="s1">      &lt;option&gt;&lt;/option&gt; \</span>
<span class="s1">            {{#date_values}} \</span>
<span class="s1">            &lt;option startDate=&quot;{{startDate}}&quot; stopDate=&quot;{{stopDate}}&quot; {{selected}}&gt;{{val}}&lt;/option&gt; \</span>
<span class="s1">            {{/date_values}} \</span>
<span class="s1">          &lt;/select&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">list</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">    &lt;style&gt; \</span>
<span class="s1">    .list-filter-item { cursor:pointer; } \</span>
<span class="s1">    .list-filter-item:hover { background: lightblue;cursor:pointer; } \</span>
<span class="s1">    &lt;/style&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}  \</span>
<span class="s1">            &lt;a class=&quot;js-remove-filter&quot; href=&quot;#&quot; title=&quot;Remove this filter&quot;&gt;&amp;times;&lt;/a&gt; \</span>
<span class="s1">      &lt;/legend&gt; \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;display:{{useLeftLabel}}&quot;&gt;{{label}} \</span>
<span class="s1">          &lt;a class=&quot;js-remove-filter&quot; href=&quot;#&quot; title=&quot;Remove this filter&quot;&gt;&amp;times;&lt;/a&gt; \</span>
<span class="s1">        &lt;/div&gt; \</span>
<span class="s1">      &lt;div style=&quot;max-height:500px;width:100%;border:1px solid grey;overflow:auto;&quot;&gt; \</span>
<span class="s1">        &lt;table class=&quot;table table-striped table-hover table-condensed&quot; style=&quot;width:100%&quot; data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; &gt; \</span>
<span class="s1">        &lt;tbody&gt;\</span>
<span class="s1">        {{#values}} \</span>
<span class="s1">        &lt;tr class=&quot;{{selected}}&quot;&gt;&lt;td class=&quot;list-filter-item&quot; &gt;{{val}}&lt;/td&gt;&lt;td style=&quot;text-align:right&quot;&gt;{{count}}&lt;/td&gt;&lt;/tr&gt; \</span>
<span class="s1">        {{/values}} \</span>
<span class="s1">        &lt;/tbody&gt;\</span>
<span class="s1">        &lt;/table&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">      &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">  &#39;</span><span class="p">,</span>
            <span class="nx">listbox</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">      &lt;select class=&quot;fields data-control-id&quot;  multiple SIZE=10&gt; \</span>
<span class="s1">            {{#values}} \</span>
<span class="s1">            &lt;option value=&quot;{{val}}&quot; {{selected}}&gt;{{valCount}}&lt;/option&gt; \</span>
<span class="s1">            {{/values}} \</span>
<span class="s1">          &lt;/select&gt; \</span>
<span class="s1">      &lt;br&gt; \</span>
<span class="s1">          &lt;input type=&quot;button&quot; class=&quot;btn&quot; id=&quot;setFilterValueButton&quot; value=&quot;Set&quot;&gt;&lt;/input&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">listbox_styled</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">      &lt;script&gt; \</span>
<span class="s1">      $(function() { \</span>
<span class="s1">        $(&quot;.chzn-select-deselect&quot;).chosen({allow_single_deselect:true}); \</span>
<span class="s1">      }); \</span>
<span class="s1">      &lt;/script&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}} \</span>
<span class="s1">        &lt;/legend&gt;  \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;padding-top:4px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">      &lt;select class=&quot;chzn-select-deselect data-control-id&quot; multiple data-placeholder=&quot;{{innerLabel}}&quot;&gt; \</span>
<span class="s1">            {{#values}} \</span>
<span class="s1">            &lt;option value=&quot;{{val}}&quot; {{selected}}&gt;{{valCount}}&lt;/option&gt; \</span>
<span class="s1">            {{/values}} \</span>
<span class="s1">          &lt;/select&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">radiobuttons</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">        &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">            &lt;div data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">                &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">          &lt;div style=&quot;float:left;padding-right:10px;padding-top:4px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">          &lt;div class=&quot;btn-group data-control-id&quot; &gt; \</span>
<span class="s1">            &lt;button class=&quot;btn grouped-button btn-primary&quot;&gt;All&lt;/button&gt; \</span>
<span class="s1">                  {{#values}} \</span>
<span class="s1">              &lt;button class=&quot;btn grouped-button {{selected}}&quot;&gt;{{val}}&lt;/button&gt; \</span>
<span class="s1">                  {{/values}} \</span>
<span class="s1">                &lt;/div&gt; \</span>
<span class="s1">            &lt;/div&gt; \</span>
<span class="s1">        &lt;/div&gt; \</span>
<span class="s1">        &#39;</span><span class="p">,</span>
            <span class="nx">multibutton</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">    &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">        &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}} \</span>
<span class="s1">        &lt;/legend&gt;  \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;padding-top:4px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">        &lt;div class=&quot;btn-group data-control-id&quot; &gt; \</span>
<span class="s1">              {{#values}} \</span>
<span class="s1">          &lt;button class=&quot;btn grouped-button {{selected}}&quot;&gt;{{val}}&lt;/button&gt; \</span>
<span class="s1">              {{/values}} \</span>
<span class="s1">          &lt;/div&gt; \</span>
<span class="s1">        &lt;/fieldset&gt; \</span>
<span class="s1">    &lt;/div&gt; \</span>
<span class="s1">    &#39;</span><span class="p">,</span>
            <span class="nx">legend</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">    &lt;style&gt; \</span>
<span class="s1">      .legend-item { \</span>
<span class="s1">          border-top:2px solid black;border-left:2px solid black; \</span>
<span class="s1">          border-bottom:2px solid darkgrey;border-right:2px solid darkgrey; \</span>
<span class="s1">          width:16px;height:16px;padding:1px;margin:5px; \</span>
<span class="s1">          opacity: 0.85 \</span>
<span class="s1">          }  \</span>
<span class="s1">   .legend-item.not-selected { background-color:transparent !important; } /* the idea is that the color &quot;not-selected&quot; overrides the original color (this way we may use a global style) */ \</span>
<span class="s1">    &lt;/style&gt; \</span>
<span class="s1">      &lt;div class=&quot;filter-{{type}} filter&quot; id=&quot;{{ctrlId}}&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot; data-control-type=&quot;{{controlType}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">      &lt;div style=&quot;float:left;padding-right:10px;display:{{useLeftLabel}}&quot;&gt;{{label}}&lt;/div&gt; \</span>
<span class="s1">      &lt;table style=&quot;width:100%;background-color:transparent&quot;&gt;\</span>
<span class="s1">      {{#values}} \</span>
<span class="s1">        &lt;tr&gt; \</span>
<span class="s1">        &lt;td style=&quot;width:25px&quot;&gt;&lt;div class=&quot;legend-item {{notSelected}}&quot; myValue=&quot;{{val}}&quot; style=&quot;background-color:{{color}}&quot;&gt;&lt;/td&gt; \</span>
<span class="s1">        &lt;td style=&quot;vertical-align:middle&quot;&gt;&lt;label style=&quot;color:{{color}};text-shadow: black 1px 1px, black -1px -1px, black -1px 1px, black 1px -1px, black 0px 1px, black 0px -1px, black 1px 0px, black -1px 0px&quot;&gt;{{val}}&lt;/label&gt;&lt;/td&gt;\</span>
<span class="s1">        &lt;td&gt;&lt;label style=&quot;text-align:right&quot;&gt;[{{count}}]&lt;/label&gt;&lt;/td&gt;\</span>
<span class="s1">        &lt;/tr&gt;\</span>
<span class="s1">      {{/values}}\</span>
<span class="s1">      &lt;/table&gt; \</span>
<span class="s1">      &lt;/fieldset&gt; \</span>
<span class="s1">      &lt;/div&gt; \</span>
<span class="s1">  &#39;</span><span class="p">,</span>
            <span class="nx">color_legend</span><span class="o">:</span><span class="s1">&#39; \</span>
<span class="s1">  &lt;div class=&quot;filter-{{type}} filter&quot; style=&quot;width:{{totWidth2}}px;max-height:{{totHeight2}}px&quot;&gt; \</span>
<span class="s1">        &lt;fieldset data-filter-field=&quot;{{field}}&quot; data-filter-id=&quot;{{id}}&quot; data-filter-type=&quot;{{type}}&quot;&gt; \</span>
<span class="s1">            &lt;legend style=&quot;display:{{useLegend}}&quot;&gt;{{label}}&lt;/legend&gt;  \</span>
<span class="s1">        &lt;div style=&quot;float:left;padding-right:10px;height:{{lineHeight}}px;display:{{useLeftLabel}}&quot;&gt; \</span>
<span class="s1">          &lt;label style=&quot;line-height:{{lineHeight}}px&quot;&gt;{{label}}&lt;/label&gt; \</span>
<span class="s1">        &lt;/div&gt; \</span>
<span class="s1">        &lt;div style=&quot;width:{{totWidth}}px;height:{{totHeight}}px;display:inline&quot;&gt; \</span>
<span class="s1">          &lt;svg height=&quot;{{totHeight}}&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt; \</span>
<span class="s1">          {{#colorValues}} \</span>
<span class="s1">              &lt;rect width=&quot;{{width}}&quot; height={{lineHeight}} fill=&quot;{{color}}&quot; x=&quot;{{x}}&quot; y={{y}}/&gt; \</span>
<span class="s1">            &lt;text width=&quot;{{width}}&quot; fill=&quot;{{textColor}}&quot; x=&quot;{{x}}&quot; y=&quot;{{yplus30}}&quot;&gt;{{val}}&lt;/text&gt; \</span>
<span class="s1">          {{/colorValues}}\</span>
<span class="s1">          &lt;/svg&gt;    \</span>
<span class="s1">        &lt;/div&gt; \</span>
<span class="s1">      &lt;/fieldset&gt; \</span>
<span class="s1">  &lt;/div&gt; \</span>
<span class="s1">  &#39;</span>
        <span class="p">},</span>

        <span class="nx">FiltersTemplate</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">&quot;range_calendar&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span>
            <span class="s2">&quot;month_week_calendar&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;list&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;legend&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;dropdown&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;dropdown_styled&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;dropdown_date_range&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span>
            <span class="s2">&quot;listbox&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;listbox_styled&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;term&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span>
            <span class="s2">&quot;range&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;slider&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;range_slider&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;range_slider_styled&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;color_legend&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;multibutton&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
            <span class="s2">&quot;radiobuttons&quot;</span><span class="o">:</span><span class="p">{</span> <span class="nx">needFacetedField</span><span class="o">:</span><span class="kc">false</span><span class="p">}</span>


        <span class="p">},</span>

        <span class="nx">events</span><span class="o">:</span><span class="p">{</span>
            <span class="s1">&#39;click .js-remove-filter&#39;</span><span class="o">:</span><span class="s1">&#39;onRemoveFilter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;click .js-add-filter&#39;</span><span class="o">:</span><span class="s1">&#39;onAddFilterShow&#39;</span><span class="p">,</span>
            <span class="s1">&#39;click #addFilterButton&#39;</span><span class="o">:</span><span class="s1">&#39;onAddFilter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;click .list-filter-item&#39;</span><span class="o">:</span><span class="s1">&#39;onListItemClicked&#39;</span><span class="p">,</span>
            <span class="s1">&#39;click .legend-item&#39;</span><span class="o">:</span><span class="s1">&#39;onLegendItemClicked&#39;</span><span class="p">,</span>
            <span class="s1">&#39;click #setFilterValueButton&#39;</span><span class="o">:</span><span class="s1">&#39;onFilterValueChanged&#39;</span><span class="p">,</span>
            <span class="s1">&#39;change .drop-down&#39;</span><span class="o">:</span><span class="s1">&#39;onFilterValueChanged&#39;</span><span class="p">,</span>
            <span class="s1">&#39;change .chzn-select-deselect&#39;</span><span class="o">:</span><span class="s1">&#39;onFilterValueChanged&#39;</span><span class="p">,</span>
            <span class="s1">&#39;change .drop-down2&#39;</span><span class="o">:</span><span class="s1">&#39;onListItemClicked&#39;</span><span class="p">,</span>
            <span class="s1">&#39;change .drop-down3&#39;</span><span class="o">:</span><span class="s1">&#39;onPeriodChanged&#39;</span><span class="p">,</span>
            <span class="s1">&#39;click .grouped-button&#39;</span><span class="o">:</span><span class="s1">&#39;onButtonsetClicked&#39;</span><span class="p">,</span>
            <span class="s1">&#39;change .slider-styled&#39;</span><span class="o">:</span><span class="s1">&#39;onStyledSliderValueChanged&#39;</span>
        <span class="p">},</span>

        <span class="nx">activeFilters</span><span class="o">:</span><span class="k">new</span> <span class="nb">Array</span><span class="p">(),</span>
        <span class="nx">_sourceDataset</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
        <span class="nx">_selectedClassName</span><span class="o">:</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="c1">// use bootstrap ready-for-use classes to highlight list item selection (avail classes are success, warning, info &amp; error)</span>

        <span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;render&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;getFieldType&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;onRemoveFilter&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;onPeriodChanged&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;findActiveFilterByField&#39;</span><span class="p">);</span>

            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateDropdown&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateDropdownStyled&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateSlider&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateSliderStyled&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateRadiobuttons&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateRangeSlider&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateRangeSliderStyled&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateRangeCalendar&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateMonthWeekCalendar&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateDropdownDateRange&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateList&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateListbox&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateListboxStyled&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateLegend&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;updateMultibutton&#39;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;redrawGenericControl&#39;</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">_sourceDataset</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">sourceDataset</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">uid</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">);</span> <span class="c1">// unique id of the view containing all filters</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">numId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// auto-increasing id used for a single filter</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">sourceFields</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">sourceFields</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">filterDialogTitle</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">filterDialogDescription</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">useHorizontalLayout</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">useHorizontalLayout</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">showBackground</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">showBackground</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">showBackground</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">activeFilters</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">_actions</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">actions</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sourceFields</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">sourceFields</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sourceFields</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">addNewFilterControl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sourceFields</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>not all filters required a source of data</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;query:done&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">queryState</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;selection:done&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">areValuesEqual</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>this also handles date equalities.
For instance comparing a Date obj with its corresponding timer value now returns true</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">a</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">==</span> <span class="nx">b</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">==</span> <span class="nx">b</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span> <span class="o">==</span> <span class="nx">b</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">valueOf</span> <span class="o">==</span> <span class="nx">b</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">update</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>retrieve filter values (start/from/term/...)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">queryState</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;selections&#39;</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">field</span> <span class="o">==</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">list</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">list</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">term</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">start</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">start</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">stop</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">stop</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="kd">var</span> <span class="nx">currFilters</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.filter&quot;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">currFilters</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">flt</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">currFilterCtrl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.data-control-id&quot;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currFilterCtrl</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currFilterCtrl</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>console.log($(currFilterCtrl));</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">currFilterCtrlFrom</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.data-control-id-from&quot;</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">currFilterCtrlTo</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.data-control-id-to&quot;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="kd">var</span> <span class="nx">currActiveFilter</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">ctrlId</span> <span class="o">==</span> <span class="nx">flt</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">currActiveFilter</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">userChanged</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>skip the filter that triggered the change</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">switch</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>term</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">case</span> <span class="s2">&quot;dropdown&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateDropdown</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;dropdown_styled&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateDropdownStyled</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;slider&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateSlider</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;slider_styled&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateSliderStyled</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;radiobuttons&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateRadiobuttons</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>range</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">case</span> <span class="s2">&quot;range_slider&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateRangeSlider</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;range_slider_styled&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateRangeSliderStyled</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;range_calendar&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateRangeCalendar</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrlFrom</span><span class="p">),</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrlTo</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;month_week_calendar&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateMonthWeekCalendar</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;dropdown_date_range&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateDropdownDateRange</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>list</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">case</span> <span class="s2">&quot;list&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateList</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;listbox&quot;</span><span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateListbox</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;listbox_styled&quot;</span><span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateListboxStyled</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;legend&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateLegend</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                        <span class="k">case</span> <span class="s2">&quot;multibutton&quot;</span> <span class="o">:</span>
                            <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">updateMultibutton</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">flt</span><span class="p">),</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">currFilterCtrl</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">},</span>

        <span class="nx">computeUserChoices</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">valueList</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">valueList</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">)</span>
                <span class="nx">valueList</span> <span class="o">=</span> <span class="p">[</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">];</span>

            <span class="k">return</span> <span class="nx">valueList</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">redrawGenericControl</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createSingleFilter</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>
            <span class="nx">filterContainer</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">html</span><span class="p">(</span><span class="nx">out</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">updateDropdown</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">computeUserChoices</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">filterCtrl</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">else</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;option:first&quot;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">,</span> <span class="s2">&quot;selected&quot;</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s2">&quot;selectedIndex&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;dimmed&quot;</span><span class="p">);</span>
            <span class="k">else</span> <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;dimmed&quot;</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateDropdownStyled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateSlider</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">computeUserChoices</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">slider</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#amount&quot;</span> <span class="o">+</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">ctrlId</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">label</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// sistema di riserva</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;slide&quot;</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">);</span> <span class="c1">// non pare funzionare</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">updateSliderStyled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">computeUserChoices</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">jslider</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">},</span>
        <span class="nx">updateRadiobuttons</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">computeUserChoices</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">buttons</span> <span class="o">=</span> <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.grouped-button&quot;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">buttons</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">btn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">btn</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;btn-primary&quot;</span><span class="p">)</span>
            <span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>do not use each or other jquery/underscore methods since they don't work well here</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">buttons</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">buttons</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">valueList</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">btn</span><span class="p">.</span><span class="nx">html</span><span class="p">()))</span> <span class="p">{</span>
                                <span class="nx">btn</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;btn-primary&quot;</span><span class="p">);</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;btn-primary&quot;</span><span class="p">);</span> <span class="c1">// select button &quot;All&quot;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="nx">$</span><span class="p">(</span><span class="nx">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;btn-primary&quot;</span><span class="p">);</span> <span class="c1">// select button &quot;All&quot;</span>
        <span class="p">},</span>
        <span class="nx">updateRangeSlider</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">computeUserChoices</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">slider</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">slider</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#amount&quot;</span> <span class="o">+</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">ctrlId</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">label</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// sistema di riserva</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;slide&quot;</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">);</span> <span class="c1">// non pare funzionare</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">updateRangeSliderStyled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">computeUserChoices</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">jslider</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">valueList</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">},</span>
        <span class="nx">updateRangeCalendar</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrlFrom</span><span class="p">,</span> <span class="nx">filterCtrlTo</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateMonthWeekCalendar</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateDropdownDateRange</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateList</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateListbox</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateListboxStyled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateLegend</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">redrawGenericControl</span><span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">updateMultibutton</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">filterContainer</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">valueList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">computeUserChoices</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">buttons</span> <span class="o">=</span> <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.grouped-button&quot;</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">buttons</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">btn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">btn</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;btn-info&quot;</span><span class="p">)</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>from now on, do not use each or other jquery/underscore methods since they don't work well here</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">valueList</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">buttons</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">buttons</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">valueList</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">btn</span><span class="p">.</span><span class="nx">html</span><span class="p">()))</span>
                            <span class="nx">btn</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;btn-info&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">filterRender</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">self</span><span class="p">.</span><span class="nx">createSingleFilter</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// make sure you pass the current active filter</span>
        <span class="p">},</span>
        <span class="nx">createSingleFilter</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">self</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>check facet</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">filterTemplate</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">FiltersTemplate</span><span class="p">[</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">facetTerms</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">filterTemplate</span><span class="p">)</span>
                <span class="k">throw</span><span class="p">(</span><span class="s2">&quot;GenericFilter: Invalid control type &quot;</span> <span class="o">+</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">filterTemplate</span><span class="p">.</span><span class="nx">needFacetedField</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">getFacetByFieldId</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">field</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
                    <span class="k">throw</span> <span class="s2">&quot;GenericFilter: no facet present for field [&quot;</span> <span class="o">+</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">field</span> <span class="o">+</span> <span class="s2">&quot;]. Define a facet before filter render&quot;</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span> <span class="o">||</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="c1">// sort if numeric (Chrome issue)</span>
                  <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">currObj</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">currObj</span><span class="p">.</span><span class="nx">term</span><span class="p">;</span>
                  <span class="p">});</span>
                    
                <span class="nx">facetTerms</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">label</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">label</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">field</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>if facet are not defined i use all dataset records</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">}</span>

            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">useLegend</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">labelPosition</span> <span class="o">!=</span> <span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">useLegend</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>

            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">useLeftLabel</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">labelPosition</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">useLeftLabel</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">labelPosition</span> <span class="o">==</span> <span class="s1">&#39;inside&#39;</span><span class="p">)</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">innerLabel</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">label</span><span class="p">;</span>

            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>add value list to selected filter or templating of record values will not work</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;calendar&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">startDate</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">dateConvert</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">stop</span><span class="p">)</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">endDate</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">dateConvert</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">stop</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;slider&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">facetTerms</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">facetTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">term</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nx">facetTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">term</span><span class="p">;</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span> <span class="o">=</span> <span class="nx">facetTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">term</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;month_week_calendar&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">weekValues</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">periodValues</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="nx">val</span><span class="o">:</span><span class="s2">&quot;Months&quot;</span><span class="p">,</span> <span class="nx">selected</span><span class="o">:</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">period</span> <span class="o">==</span> <span class="s2">&quot;Months&quot;</span> <span class="o">?</span> <span class="s2">&quot;selected&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)},</span>
                    <span class="p">{</span><span class="nx">val</span><span class="o">:</span><span class="s2">&quot;Weeks&quot;</span><span class="p">,</span> <span class="nx">selected</span><span class="o">:</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">period</span> <span class="o">==</span> <span class="s2">&quot;Weeks&quot;</span> <span class="o">?</span> <span class="s2">&quot;selected&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)}</span>
                <span class="p">]</span>
                <span class="kd">var</span> <span class="nx">currYear</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">year</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">januaryFirst</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">currYear</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">januaryFirst_time</span> <span class="o">=</span> <span class="nx">januaryFirst</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
                <span class="kd">var</span> <span class="nx">weekOffset</span> <span class="o">=</span> <span class="nx">januaryFirst</span><span class="p">.</span><span class="nx">getDay</span><span class="p">();</span>
                <span class="kd">var</span> <span class="nx">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">w</span> <span class="o">&lt;=</span> <span class="mi">53</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">finished</span><span class="p">;</span> <span class="nx">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">weekStartTime</span> <span class="o">=</span> <span class="nx">januaryFirst_time</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">86400000</span> <span class="o">*</span> <span class="p">(</span><span class="nx">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">7</span> <span class="o">-</span> <span class="nx">weekOffset</span><span class="p">)</span> <span class="o">*</span> <span class="mi">86400000</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">weekEndTime</span> <span class="o">=</span> <span class="nx">weekStartTime</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">86400000</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="nx">weekStartTime</span> <span class="o">=</span> <span class="nx">januaryFirst_time</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">weekEndTime</span><span class="p">).</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">currYear</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">weekEndTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">currYear</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
                        <span class="nx">finished</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">weekValues</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">val</span><span class="o">:</span><span class="nx">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="nx">label</span><span class="o">:</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;%x&quot;</span><span class="p">)(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">weekStartTime</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;%x&quot;</span><span class="p">)(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">weekEndTime</span> <span class="o">-</span> <span class="mi">1000</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">,</span>
                        <span class="nx">startDate</span><span class="o">:</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">weekStartTime</span><span class="p">),</span>
                        <span class="nx">stopDate</span><span class="o">:</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">weekEndTime</span><span class="p">),</span>
                        <span class="nx">selected</span><span class="o">:</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">==</span> <span class="nx">w</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_selectedClassName</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="p">});</span>
                <span class="p">}</span>

                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">monthValues</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">m</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">;</span> <span class="nx">m</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">endYear</span> <span class="o">=</span> <span class="nx">currYear</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">endMonth</span> <span class="o">=</span> <span class="nx">m</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">endYear</span> <span class="o">=</span> <span class="nx">currYear</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                        <span class="nx">endMonth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">monthValues</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">val</span><span class="o">:</span><span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;02d&quot;</span><span class="p">)(</span><span class="nx">m</span><span class="p">),</span>
                        <span class="nx">label</span><span class="o">:</span><span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;%B&quot;</span><span class="p">)(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">m</span> <span class="o">+</span> <span class="s2">&quot;/01/2012&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">currYear</span><span class="p">,</span>
                        <span class="nx">startDate</span><span class="o">:</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">currYear</span><span class="p">,</span> <span class="nx">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="nx">stopDate</span><span class="o">:</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">endYear</span><span class="p">,</span> <span class="nx">endMonth</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="nx">selected</span><span class="o">:</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">==</span> <span class="nx">m</span> <span class="o">?</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_selectedClassName</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="p">});</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">period</span> <span class="o">==</span> <span class="s2">&quot;Months&quot;</span><span class="p">)</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">monthValues</span><span class="p">;</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">period</span> <span class="o">==</span> <span class="s2">&quot;Weeks&quot;</span><span class="p">)</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">weekValues</span><span class="p">;</span>

                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">yearValues</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="kd">var</span> <span class="nx">startYear</span> <span class="o">=</span> <span class="mi">2010</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">endYear</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()))</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">startYear</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">endYear</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">yearValues</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">val</span><span class="o">:</span><span class="nx">y</span><span class="p">,</span> <span class="nx">selected</span><span class="o">:</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">year</span> <span class="o">==</span> <span class="nx">y</span> <span class="o">?</span> <span class="s2">&quot;selected&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)});</span>

            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;dropdown_date_range&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">date_values</span> <span class="o">=</span> <span class="p">[];</span>

                <span class="kd">var</span> <span class="nx">defaultDateFilters</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;This week&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="o">:</span><span class="s2">&quot;sunday&quot;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;next sunday&quot;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;This month&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">months</span><span class="o">:</span><span class="mi">1</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;This year&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="o">:</span><span class="s2">&quot;january 1&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">years</span><span class="o">:</span><span class="mi">1</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Past week&#39;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;sunday&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">days</span><span class="o">:-</span><span class="mi">7</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Past month&#39;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">months</span><span class="o">:-</span><span class="mi">1</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Past 2 months&#39;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">months</span><span class="o">:-</span><span class="mi">2</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Past 3 months&#39;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">months</span><span class="o">:-</span><span class="mi">3</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Past 6 months&#39;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">months</span><span class="o">:-</span><span class="mi">6</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Past year&#39;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;january 1&quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="o">:</span><span class="p">{</span><span class="nx">years</span><span class="o">:-</span><span class="mi">1</span><span class="p">}},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Last 7 days&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="o">:</span><span class="s2">&quot;-6&quot;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;t +1 d&quot;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Last 30 days&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="o">:</span><span class="s2">&quot;-29&quot;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;t +1 d&quot;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Last 90 days&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="o">:</span><span class="s2">&quot;-89&quot;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;t +1 d&quot;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="nx">label</span><span class="o">:</span><span class="s1">&#39;Last 365 days&#39;</span><span class="p">,</span> <span class="nx">start</span><span class="o">:</span><span class="s2">&quot;-1 y&quot;</span><span class="p">,</span> <span class="nx">stop</span><span class="o">:</span><span class="s2">&quot;t +1 d&quot;</span><span class="p">},</span>
                <span class="p">]</span>
                <span class="kd">var</span> <span class="nx">fullDateFilters</span> <span class="o">=</span> <span class="nx">defaultDateFilters</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">skipDefaultFilters</span><span class="p">)</span>
                    <span class="nx">fullDateFilters</span> <span class="o">=</span> <span class="p">[];</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">userFilters</span><span class="p">)</span>
                    <span class="nx">fullDateFilters</span> <span class="o">=</span> <span class="nx">fullDateFilters</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">userFilters</span><span class="p">);</span>

                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">fullDateFilters</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">flt</span> <span class="o">=</span> <span class="nx">fullDateFilters</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="kd">var</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">stopDate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="nx">flt</span><span class="p">.</span><span class="nx">stop</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">startDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>
                        <span class="nx">stopDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">stop</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="nx">flt</span><span class="p">.</span><span class="nx">delta</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">startDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">startDate</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">stopDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
                            <span class="nx">stopDate</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">delta</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">stop</span> <span class="o">&amp;&amp;</span> <span class="nx">flt</span><span class="p">.</span><span class="nx">delta</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">stopDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">stop</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">stopDate</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">startDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">stopDate</span><span class="p">);</span>
                            <span class="nx">startDate</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">flt</span><span class="p">.</span><span class="nx">delta</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">startDate</span> <span class="o">&amp;&amp;</span> <span class="nx">stopDate</span> <span class="o">&amp;&amp;</span> <span class="nx">flt</span><span class="p">.</span><span class="nx">label</span><span class="p">)</span>
                        <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">date_values</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">val</span><span class="o">:</span><span class="nx">flt</span><span class="p">.</span><span class="nx">label</span><span class="p">,</span>
                            <span class="nx">startDate</span><span class="o">:</span><span class="nx">startDate</span><span class="p">,</span>
                            <span class="nx">stopDate</span><span class="o">:</span><span class="nx">stopDate</span>
                        <span class="p">});</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">date_values</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">date_values</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">val</span> <span class="o">==</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">date_values</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">selected</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_selectedClassName</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;legend&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>OLD code, somehow working but wrong</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span><span class="p">,</span> <span class="s2">&quot;term&quot;</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">origLegend</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">origLegend</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">;</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">legend</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">origLegend</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">origLegend</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">legendSelection</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">legend</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="kd">var</span> <span class="nx">notSelected</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">((</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">fieldType</span> <span class="o">!=</span> <span class="s2">&quot;date&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">legendSelection</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="o">||</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">legendSelection</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">legendSelection</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">v</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
                        <span class="nx">notSelected</span> <span class="o">=</span> <span class="s2">&quot;not-selected&quot;</span><span class="p">;</span>

                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">val</span><span class="o">:</span><span class="nx">v</span><span class="p">,</span> <span class="nx">notSelected</span><span class="o">:</span><span class="nx">notSelected</span><span class="p">,</span> <span class="nx">color</span><span class="o">:</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">color</span><span class="p">,</span> <span class="nx">count</span><span class="o">:</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">count</span><span class="p">});</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <pre><code>        NEW code. Will work when facet will be returned correctly even after filtering
  currActiveFilter.tmpValues = _.pluck(currActiveFilter.facet.attributes.terms, "term");
  for (var v in currActiveFilter.tmpValues)
  {
        var color;
        var currTerm = _.find(currActiveFilter.facet.attributes.terms, function(currT) { return currT.term == v; });
        if (typeof currTerm != "undefined" &amp;&amp; currTerm != null)
        {
            color = currTerm.color;
            count = currTerm.count;
        }
        var notSelected = "";
        var legendSelection = currActiveFilter.legend;
        if (typeof legendSelection == "undefined" || legendSelection == null || legendSelection.indexOf(v) &lt; 0)
            notSelected = "not-selected";

        currActiveFilter.values.push({val: v, notSelected: notSelected, color: color, count: count});
  }       
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;color_legend&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">ruler</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;my_string_width_calculation_ruler&quot;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ruler</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">ruler</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ruler</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">);</span>
                    <span class="nx">ruler</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s2">&quot;my_string_width_calculation_ruler&quot;</span><span class="p">);</span>
                    <span class="nx">ruler</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span><span class="p">;</span>
                    <span class="nx">ruler</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">;</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">ruler</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="kd">var</span> <span class="nx">maxWidth</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">colorValues</span> <span class="o">=</span> <span class="p">[];</span>
                
                

                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span><span class="p">,</span> <span class="s2">&quot;term&quot;</span><span class="p">);</span>

                <span class="kd">var</span> <span class="nx">pixelW</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>calculate needed pixel width for every string</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="nx">ruler</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">ruler</span><span class="p">.</span><span class="nx">offsetWidth</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">&gt;</span> <span class="nx">pixelW</span><span class="p">)</span>
                        <span class="nx">pixelW</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">pixelW</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">lineHeight</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>calculate needed row number and columns per row</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">maxColsPerRow</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">maxWidth</span> <span class="o">/</span> <span class="nx">pixelW</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">totRighe</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">maxColsPerRow</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">colsPerRow</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">totRighe</span><span class="p">);</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">totWidth</span> <span class="o">=</span> <span class="nx">colsPerRow</span> <span class="o">*</span> <span class="nx">pixelW</span><span class="p">;</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">totWidth2</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">totWidth</span> <span class="o">+</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">labelPosition</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span> <span class="o">?</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">label</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">:</span> <span class="mi">10</span><span class="p">)</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">totHeight</span> <span class="o">=</span> <span class="nx">totRighe</span> <span class="o">*</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">lineHeight</span><span class="p">;</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">totHeight2</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">totHeight</span> <span class="o">+</span> <span class="mi">40</span><span class="p">;</span>

                <span class="kd">var</span> <span class="nx">riga</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">colonna</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">tmpValues</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">facet</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">terms</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">color</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">colonna</span> <span class="o">==</span> <span class="nx">colsPerRow</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">riga</span><span class="o">++</span><span class="p">;</span>
                        <span class="nx">colonna</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">colorValues</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">width</span><span class="o">:</span><span class="nx">pixelW</span><span class="p">,</span> <span class="nx">color</span><span class="o">:</span><span class="nx">color</span><span class="p">,</span> <span class="nx">textColor</span><span class="o">:</span><span class="nx">self</span><span class="p">.</span><span class="nx">complementColor</span><span class="p">(</span><span class="nx">color</span><span class="p">),</span>
                        <span class="nx">val</span><span class="o">:</span><span class="nx">v</span><span class="p">,</span> <span class="nx">x</span><span class="o">:</span><span class="nx">pixelW</span> <span class="o">*</span> <span class="nx">colonna</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span><span class="nx">riga</span> <span class="o">*</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">lineHeight</span><span class="p">,</span> <span class="nx">yplus30</span><span class="o">:</span><span class="nx">riga</span> <span class="o">*</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">lineHeight</span> <span class="o">+</span> <span class="mi">25</span> <span class="p">});</span>

                    <span class="nx">colonna</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">lastV</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

                <span class="k">if</span><span class="p">(</span><span class="nx">facetTerms</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">facetTerms</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">facetTerms</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">term</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">facetTerms</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">count</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_selectedClassName</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;radiobuttons&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">)))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s1">&#39;btn-primary&#39;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;multibutton&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s1">&#39;btn-info&#39;</span>
                            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">v</span><span class="p">))</span>
                                        <span class="nx">selected</span> <span class="o">=</span> <span class="s1">&#39;btn-info&#39;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;dropdown&quot;</span> <span class="o">||</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;dropdown_styled&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">)))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;listbox&quot;</span> <span class="o">||</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;listbox_styled&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span>
                            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">v</span><span class="p">))</span>
                                        <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">showCount</span><span class="p">)</span>
                            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">val</span><span class="o">:</span><span class="nx">v</span><span class="p">,</span> <span class="nx">selected</span><span class="o">:</span><span class="nx">selected</span><span class="p">,</span> <span class="nx">valCount</span><span class="o">:</span> <span class="nx">v</span><span class="o">+</span><span class="s2">&quot;\t[&quot;</span><span class="o">+</span><span class="nx">count</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="nx">count</span><span class="o">:</span> <span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">count</span><span class="o">+</span><span class="s2">&quot;]&quot;</span> <span class="p">});</span>
                        <span class="k">else</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">val</span><span class="o">:</span><span class="nx">v</span><span class="p">,</span> <span class="nx">selected</span><span class="o">:</span><span class="nx">selected</span><span class="p">,</span> <span class="nx">valCount</span><span class="o">:</span> <span class="nx">v</span> <span class="p">});</span>

                        <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;slider&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&gt;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span>
                                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>

                            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&lt;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span>
                                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>

                            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;styled&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">lastV</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
                                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">-</span> <span class="nx">lastV</span><span class="p">;</span>
                                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">-</span> <span class="nx">lastV</span> <span class="o">!=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span><span class="p">)</span>
                                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="nx">lastV</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">getRecords</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">field</span><span class="p">);</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">throw</span> <span class="s2">&quot;widget.genericfilter: unable to find field [&quot;</span><span class="o">+</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">field</span><span class="o">+</span><span class="s2">&quot;] in dataset&quot;</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">getFieldValue</span><span class="p">(</span><span class="nx">field</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;radiobuttons&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">)))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s1">&#39;btn-primary&#39;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;multibutton&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s1">&#39;btn-info&#39;</span>
                            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">v</span><span class="p">))</span>
                                        <span class="nx">selected</span> <span class="o">=</span> <span class="s1">&#39;btn-info&#39;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;dropdown&quot;</span> <span class="o">||</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;dropdown_styled&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">)))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;listbox&quot;</span> <span class="o">||</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;listbox_styled&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span>
                                <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span>
                            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">areValuesEqual</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">v</span><span class="p">))</span>
                                        <span class="nx">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">val</span><span class="o">:</span><span class="nx">v</span><span class="p">,</span> <span class="nx">record</span><span class="o">:</span><span class="nx">record</span><span class="p">,</span> <span class="nx">selected</span><span class="o">:</span><span class="nx">selected</span><span class="p">,</span> <span class="nx">valCount</span><span class="o">:</span> <span class="nx">v</span> <span class="p">});</span>

                        <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;slider&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&gt;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span>
                                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>

                            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&lt;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span>
                                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>

                            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;styled&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">lastV</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
                                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">-</span> <span class="nx">lastV</span><span class="p">;</span>
                                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">-</span> <span class="nx">lastV</span> <span class="o">!=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span><span class="p">)</span>
                                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="nx">lastV</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>

                    <span class="p">})</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="s2">&quot;widget.genericfilter: nor facet or dataset present to build filter&quot;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;slider&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">from</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span>
                        <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">from</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">to</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span>
                        <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span>
                        <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;styled&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span>
                            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">mean</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">min</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step1</span> <span class="o">!=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step1</span><span class="p">)</span> <span class="o">||</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step2</span> <span class="o">!=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step2</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step1</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step2</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step1</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">mean</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">step2</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">ctrlId</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">uid</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">numId</span><span class="p">;</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">numId</span><span class="o">++</span><span class="p">;</span>

            <span class="k">return</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">filterTemplates</span><span class="p">[</span><span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">],</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">tmplData</span> <span class="o">=</span> <span class="p">{</span><span class="nx">filters</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">};</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">flt</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">flt</span><span class="p">.</span><span class="nx">hrVisible</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
                <span class="nx">flt</span><span class="p">.</span><span class="nx">self</span> <span class="o">=</span> <span class="nx">self</span><span class="p">;</span> <span class="c1">// pass self to filters!</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>map them to the correct controlType and retain their values (start/from/term/...)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">queryState</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;selections&#39;</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">field</span> <span class="o">==</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">list</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">list</span>
                            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">term</span>
                            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">start</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">start</span>
                            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">stop</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">stop</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">});</span>

                <span class="nx">tmplData</span><span class="p">.</span><span class="nx">fields</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>

            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">tmplData</span><span class="p">.</span><span class="nx">filters</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">hrVisible</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

            <span class="kd">var</span> <span class="nx">resultType</span> <span class="o">=</span> <span class="s2">&quot;filtered&quot;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">resultType</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span>
                <span class="nx">resultType</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">resultType</span><span class="p">;</span>

            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filterDialogTitle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterDialogTitle</span><span class="p">;</span>
            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filterDialogDescription</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterDialogDescription</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">filterDialogTitle</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterDialogDescription</span><span class="p">)</span>
                <span class="nx">tmplData</span><span class="p">.</span><span class="nx">titlePresent</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span><span class="p">;</span>
            <span class="k">else</span> <span class="nx">tmplData</span><span class="p">.</span><span class="nx">titlePresent</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>
            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">dateConvert</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">dateConvert</span><span class="p">;</span>
            <span class="nx">tmplData</span><span class="p">.</span><span class="nx">filterRender</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">filterRender</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">currTemplate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useHorizontalLayout</span><span class="p">)</span>
                <span class="nx">currTemplate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">templateHoriz</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">showBackground</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">tmplData</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">showBackground</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s2">&quot; well&quot;</span><span class="p">;</span>

                    <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;well&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">currTemplate</span><span class="p">,</span> <span class="nx">tmplData</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">out</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">complementColor</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>calculates a readable color to use over a given color
usually returns black for light colors and white for dark colors.
  var c1 = c.hsv();
  if (c1[2] >= 0.5)
      return chroma.hsv(c1[0],c1[1],0);
  else return chroma.hsv(c1[0],c1[1],1);</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">c1</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">rgb</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">255</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;white&quot;</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">return</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">onButtonsetClicked</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">$fieldSet</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">fieldId</span> <span class="o">=</span> <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-field&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-control-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">classToUse</span> <span class="o">=</span> <span class="s2">&quot;btn-info&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;multibutton&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$target</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="nx">classToUse</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;radiobuttons&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>ensure one and only one selection is performed</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">classToUse</span> <span class="o">=</span> <span class="s2">&quot;btn-primary&quot;</span>
                <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.btn-group button.&#39;</span> <span class="o">+</span> <span class="nx">classToUse</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">classToUse</span><span class="p">);</span>
                <span class="p">});</span>
                <span class="nx">$target</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">classToUse</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">listaValori</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.btn-group button.&#39;</span> <span class="o">+</span> <span class="nx">classToUse</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">listaValori</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">html</span><span class="p">().</span><span class="nx">valueOf</span><span class="p">());</span> <span class="c1">// in case there&#39;s a date, convert it with valueOf</span>
            <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">currActiveFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">);</span>
            <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;multibutton&quot;</span><span class="p">)</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="nx">listaValori</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;radiobuttons&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">listaValori</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">listaValori</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">listaValori</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">html</span><span class="p">().</span><span class="nx">valueOf</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onButtonsetClicked&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="nx">listaValori</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">onLegendItemClicked</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">$fieldSet</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">fieldId</span> <span class="o">=</span> <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-field&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-control-type&#39;</span><span class="p">);</span>

            <span class="nx">$target</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;not-selected&quot;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">listaValori</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">$fieldSet</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.legend-item&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;not-selected&quot;</span><span class="p">))</span>
                    <span class="nx">listaValori</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;myValue&quot;</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">());</span> <span class="c1">// in case there&#39;s a date, convert it with valueOf</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>make sure at least one value is selected</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">listaValori</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">currActiveFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">)</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="nx">currActiveFilter</span><span class="p">.</span><span class="nx">legend</span> <span class="o">=</span> <span class="nx">listaValori</span><span class="p">;</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onLegendItemClicked&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="nx">listaValori</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">currActiveFilter</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;not-selected&quot;</span><span class="p">);</span> <span class="c1">// reselect the item and exit</span>
        <span class="p">},</span>
        <span class="nx">onListItemClicked</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>let's check if user clicked on combobox or table and behave consequently</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">$table</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">$targetTD</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">$targetOption</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">$combo</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$target</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">$targetTD</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">;</span>
                <span class="nx">$table</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">();</span>
                <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-type&#39;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span><span class="p">)</span>
                    <span class="nx">$combo</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.drop-down2&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">$target</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">$combo</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">;</span>
                <span class="nx">$table</span> <span class="o">=</span> <span class="nx">$combo</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.table&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">handleListItemClicked</span><span class="p">(</span><span class="nx">$targetTD</span><span class="p">,</span> <span class="nx">$table</span><span class="p">,</span> <span class="nx">$combo</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">handleListItemClicked</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$targetTD</span><span class="p">,</span> <span class="nx">$table</span><span class="p">,</span> <span class="nx">$combo</span><span class="p">,</span> <span class="nx">ctrlKey</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">fieldId</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-field&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-control-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-type&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">$targetTD</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>case month<em>week</em>calendar
user clicked on year combo</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">year</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$combo</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>update year value in filter (so that the value is retained after re-rendering)</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">).</span><span class="nx">year</span> <span class="o">=</span> <span class="nx">year</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">$targetTD</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>user clicked on table</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ctrlKey</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$table</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_selectedClassName</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">}</span>
                <span class="nx">$targetTD</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_selectedClassName</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">listaValori</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$table</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;tr.&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_selectedClassName</span> <span class="o">+</span> <span class="s2">&quot; td&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="nx">listaValori</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
                    <span class="p">});</span>
                <span class="p">}</span>

                <span class="kd">var</span> <span class="nx">currFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">);</span>
                <span class="nx">currFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>case month<em>week</em>calendar</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="kd">var</span> <span class="nx">year</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$combo</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span>
                    <span class="kd">var</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nx">$targetTD</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;startDate&#39;</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">$targetTD</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;stopDate&#39;</span><span class="p">);</span>

                    <span class="nx">currFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">$targetTD</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;myValue&#39;</span><span class="p">);</span> <span class="c1">// save selected item for re-rendering later</span>

                    <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onListItemClicked&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="p">[</span><span class="nx">startDate</span><span class="p">,</span> <span class="nx">endDate</span><span class="p">],</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">currFilter</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onListItemClicked&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="nx">listaValori</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">currFilter</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;term&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onListItemClicked&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="p">[</span><span class="nx">$targetTD</span><span class="p">.</span><span class="nx">text</span><span class="p">()],</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">currFilter</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>action could be add or remove</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">doAction</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">fieldName</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">actionType</span><span class="p">,</span> <span class="nx">currFilter</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span><span class="o">=</span><span class="k">this</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">ciccio</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>TODO it is not efficient, record must be indicized by term
TODO conversion to string is not correct, original value must be used</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">currFilter</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
                  <span class="kd">var</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">currFilter</span><span class="p">.</span><span class="nx">field</span><span class="p">);</span>
                  <span class="k">if</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span><span class="nx">v</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">getFieldValueUnrendered</span><span class="p">(</span><span class="nx">field</span><span class="p">).</span><span class="nx">toString</span><span class="p">()))</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">record</span><span class="p">);</span>
              <span class="p">};</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>I'm using record (not facet) so I can pass it to actions</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">actions</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">actions</span><span class="p">;</span>
                <span class="nx">actions</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">currAction</span><span class="p">){</span>
                    <span class="nx">currAction</span><span class="p">.</span><span class="nx">action</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">currAction</span><span class="p">.</span><span class="nx">mapping</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span>
            <span class="p">{</span>

                <span class="kd">var</span> <span class="nx">actions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">actions</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">eventData</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="nx">eventData</span><span class="p">[</span><span class="nx">fieldName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">values</span><span class="p">;</span>

                <span class="nx">recline</span><span class="p">.</span><span class="nx">ActionUtility</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="nx">actions</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">,</span> <span class="nx">eventData</span><span class="p">,</span> <span class="nx">actionType</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">dateConvert</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">dd</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">dd</span><span class="p">.</span><span class="nx">toDateString</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">dateConvertBack</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>convert 01/31/2012  to 2012-01-31 00:00:00</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\D/</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nx">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; 00:00:00&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">onStyledSliderValueChanged</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">fieldId</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-field&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">fieldType</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-control-type&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;term&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">term</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">activeFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">);</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">term</span><span class="p">;</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="p">[</span><span class="nx">term</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onStyledSliderValueChanged&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="p">[</span><span class="nx">term</span><span class="p">],</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">activeFilter</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">activeFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">);</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">fromTo</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">fromTo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="kd">var</span> <span class="nx">to</span> <span class="o">=</span> <span class="nx">fromTo</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">from</span> <span class="o">=</span> <span class="nx">from</span><span class="p">;</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onStyledSliderValueChanged&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="p">[</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">],</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">activeFilter</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">onFilterValueChanged</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">fieldId</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-field&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">fieldType</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-control-type&#39;</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">activeFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">);</span>
            <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;term&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">term</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">termObj</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.data-control-id&#39;</span><span class="p">);</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nx">controlType</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s2">&quot;term&quot;</span><span class="o">:</span>
                        <span class="nx">term</span> <span class="o">=</span> <span class="nx">termObj</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;slider&quot;</span><span class="o">:</span>
                        <span class="nx">term</span> <span class="o">=</span> <span class="nx">termObj</span><span class="p">.</span><span class="nx">slider</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;slider_styled&quot;</span><span class="o">:</span>
                        <span class="nx">term</span> <span class="o">=</span> <span class="nx">termObj</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;dropdown&quot;</span><span class="o">:</span>
                    <span class="k">case</span> <span class="s2">&quot;dropdown_styled&quot;</span><span class="o">:</span>
                        <span class="nx">term</span> <span class="o">=</span> <span class="nx">termObj</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;listbox&quot;</span><span class="o">:</span>
                        <span class="nx">term</span> <span class="o">=</span> <span class="nx">termObj</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
                        <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">term</span><span class="p">;</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="p">[</span><span class="nx">term</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onFilterValueChanged&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="p">[</span><span class="nx">term</span><span class="p">],</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">activeFilter</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
                <span class="kd">var</span> <span class="nx">listObj</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.data-control-id&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//return a plain HTML select obj</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">listObj</span><span class="p">.</span><span class="nx">options</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">listObj</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">selected</span><span class="p">)</span>
                        <span class="nx">list</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">listObj</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">value</span><span class="p">);</span>

                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="nx">list</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onFilterValueChanged&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="nx">list</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="nx">activeFilter</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">from</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">to</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">fromTo</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">fromObj</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.data-control-id-from&#39;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">toObj</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.data-control-id-to&#39;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">fromToObj</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.data-control-id&#39;</span><span class="p">);</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nx">controlType</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s2">&quot;range&quot;</span><span class="o">:</span>
                        <span class="nx">from</span> <span class="o">=</span> <span class="nx">fromObj</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
                        <span class="nx">to</span> <span class="o">=</span> <span class="nx">toObj</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;range_slider&quot;</span><span class="o">:</span>
                        <span class="nx">from</span> <span class="o">=</span> <span class="nx">fromToObj</span><span class="p">.</span><span class="nx">slider</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                        <span class="nx">to</span> <span class="o">=</span> <span class="nx">fromToObj</span><span class="p">.</span><span class="nx">slider</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;range_slider_styled&quot;</span><span class="o">:</span>
                        <span class="nx">fromTo</span> <span class="o">=</span> <span class="nx">fromToObj</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">);</span>
                        <span class="nx">from</span> <span class="o">=</span> <span class="nx">fromTo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                        <span class="nx">to</span> <span class="o">=</span> <span class="nx">fromTo</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;range_calendar&quot;</span><span class="o">:</span>
                        <span class="nx">from</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">fromObj</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span>
                        <span class="nx">to</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">toObj</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s2">&quot;dropdown_date_range&quot;</span><span class="o">:</span>
                        <span class="nx">from</span> <span class="o">=</span> <span class="nx">fromToObj</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;:selected&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;startDate&quot;</span><span class="p">);</span>
                        <span class="nx">to</span> <span class="o">=</span> <span class="nx">fromToObj</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;:selected&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;stopDate&quot;</span><span class="p">);</span>
                        <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="nx">fromToObj</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
                        <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">from</span> <span class="o">=</span> <span class="nx">from</span><span class="p">;</span>
                <span class="nx">activeFilter</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onFilterValueChanged&quot;</span><span class="p">,</span> <span class="nx">fieldId</span><span class="p">,</span> <span class="p">[</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">],</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span><span class="nx">activeFilter</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">onAddFilterShow</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
            <span class="nx">$target</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.js-add&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">hidePanel</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">obj</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="s2">&quot;blind&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="mi">1000</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">getFilterTypeFromControlType</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">controlType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">controlType</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="s2">&quot;dropdown&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;dropdown_styled&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;slider&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;slider_styled&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;radiobuttons&quot;</span> <span class="o">:</span>
                    <span class="k">return</span> <span class="s2">&quot;term&quot;</span><span class="p">;</span>
                <span class="k">case</span> <span class="s2">&quot;range_slider&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;range_slider_styled&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;range_calendar&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;month_week_calendar&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;dropdown_date_range&quot;</span> <span class="o">:</span>
                    <span class="k">return</span> <span class="s2">&quot;range&quot;</span><span class="p">;</span>
                <span class="k">case</span> <span class="s2">&quot;list&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;listbox&quot;</span><span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;listbox_styled&quot;</span><span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;legend&quot;</span> <span class="o">:</span>
                <span class="k">case</span> <span class="s2">&quot;multibutton&quot;</span> <span class="o">:</span>
                    <span class="k">return</span> <span class="s2">&quot;list&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">controlType</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">getFieldType</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">fieldFound</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">field</span>
            <span class="p">})</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fieldFound</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">fieldFound</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="nx">fieldFound</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">);</span>

            <span class="k">return</span> <span class="s2">&quot;string&quot;</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">onAddFilter</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">();</span>
            <span class="nx">$target</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select.filterType&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">filterType</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFilterTypeFromControlType</span><span class="p">(</span><span class="nx">controlType</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select.fields&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">addNewFilterControl</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="nx">filterType</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span><span class="nx">field</span><span class="p">,</span> <span class="nx">controlType</span><span class="o">:</span><span class="nx">controlType</span><span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">addNewFilterControl</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">newFilter</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">newFilter</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
                <span class="nx">newFilter</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFilterTypeFromControlType</span><span class="p">(</span><span class="nx">newFilter</span><span class="p">.</span><span class="nx">controlType</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">newFilter</span><span class="p">.</span><span class="nx">fieldType</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
                <span class="nx">newFilter</span><span class="p">.</span><span class="nx">fieldType</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFieldType</span><span class="p">(</span><span class="nx">newFilter</span><span class="p">.</span><span class="nx">field</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">newFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;month_week_calendar&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">newFilter</span><span class="p">.</span><span class="nx">period</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span>
                    <span class="nx">newFilter</span><span class="p">.</span><span class="nx">period</span> <span class="o">=</span> <span class="s2">&quot;Months&quot;</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">newFilter</span><span class="p">.</span><span class="nx">year</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span>
                    <span class="nx">newFilter</span><span class="p">.</span><span class="nx">year</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getFullYear</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newFilter</span><span class="p">);</span>

        <span class="p">},</span>
        <span class="nx">onPeriodChanged</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$table</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.table&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>var $yearCombo = $(e.target).parent().find(".drop-down2");</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">fieldId</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-field&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-control-type&#39;</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">$table</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">currFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">);</span>
            <span class="nx">currFilter</span><span class="p">.</span><span class="nx">period</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="nx">currFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">findActiveFilterByField</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">fieldId</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">field</span> <span class="o">==</span> <span class="nx">fieldId</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">controlType</span> <span class="o">==</span> <span class="nx">controlType</span><span class="p">)</span>
                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeFilters</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span> <span class="c1">// to avoid &quot;undefined&quot; errors</span>
        <span class="p">},</span>
        <span class="nx">onRemoveFilter</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filter-field&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">controlType</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-control-type&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">currFilter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findActiveFilterByField</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span> <span class="nx">controlType</span><span class="p">);</span>
            <span class="nx">currFilter</span><span class="p">.</span><span class="nx">term</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="nx">currFilter</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">currFilter</span><span class="p">.</span><span class="nx">userChanged</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">currFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span> <span class="o">||</span> <span class="nx">currFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;month_week_calendar&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$table</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.table&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">$table</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$table</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_selectedClassName</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currFilter</span><span class="p">.</span><span class="nx">controlType</span> <span class="o">==</span> <span class="s2">&quot;slider_styled&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">filterCtrl</span> <span class="o">=</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.slider-styled&quot;</span><span class="p">)</span>
                <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">jslider</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="nx">filterCtrl</span><span class="p">.</span><span class="nx">jslider</span><span class="p">().</span><span class="nx">settings</span><span class="p">.</span><span class="nx">from</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="s2">&quot;onRemoveFilter&quot;</span><span class="p">,</span> <span class="nx">field</span><span class="p">,</span> <span class="p">[],</span> <span class="s2">&quot;remove&quot;</span><span class="p">,</span> <span class="nx">currFilter</span><span class="p">);</span>

        <span class="p">},</span>

        <span class="nx">composeStateData</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">queryString</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_sourceDataset</span><span class="p">.</span><span class="nx">queryState</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">value</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
            <span class="p">});</span>

            <span class="k">return</span> <span class="nx">items</span><span class="p">;</span>
        <span class="p">},</span>


    <span class="p">});</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">recline</span><span class="p">.</span><span class="nx">View</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 