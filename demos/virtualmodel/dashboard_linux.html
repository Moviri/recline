<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard - Recline Data Explorer and Library</title>

    <script type="text/javascript" src="../../vendor/jquery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="../../vendor/jquery/jquery.1.2.1.ba-bbq.min.js"></script>
<script type="text/javascript" src="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.js"></script>


<link type="text/css" href="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.css" rel="stylesheet" />

<script type="text/javascript" src="../../vendor/jquery-slider/js/jquery.slider.js"></script>
<link type="text/css" href="../../vendor/jquery-slider/css/jquery.slider.min.css" rel="stylesheet" />


    
<!-- NVD3 & D3 libraries -->
<script type="text/javascript" src="../../vendor/d3/v2/d3.v2.min.js"></script>

<link rel="stylesheet" href="../../vendor/nvd3/0.0.1/nv.d3.css">

<script type="text/javascript" src="../../vendor/nvd3/0.0.1/nv.d3.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/tooltip.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/utils.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/legend.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/axis.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/scatter.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/line.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/lineChart.js"></script>


<!--<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/nv.d3.min.js"></script>-->

<!--
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/tooltip.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/utils.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/legend.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/axis.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/scatter.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/line.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/lineChart.js"></script>


-->

    

<script type="text/javascript" src="../../vendor/underscore/1.3.3/underscore.js"></script>
<script type="text/javascript" src="../../vendor/backbone/0.9.2/backbone.js"></script>
<script type="text/javascript" src="../../vendor/mustache/0.5.0-dev/mustache.js"></script>


<script type="text/javascript" src="../../vendor/moment/1.6.2/moment.js"></script>
<script type="text/javascript" src="../../vendor/crossfilter/1.1.0/crossfilter.min.js"></script>
<script type="text/javascript" src="../../vendor/kartograph/unversioned/chroma.min.js"></script>

<script type="text/javascript" src="../../vendor/date/date.js"></script>

<!--
    ## Just use the all in one library version rather than individual files

  <script type="text/javascript" src="../../dist/recline.js"></script>

  -->

  <!-- model and backends -->
  <script type="text/javascript" src="../../src/model.js"></script>
  <script type="text/javascript" src="../../src/virtualmodel.js"></script>


  <script type="text/javascript" src="../../src/backend.memory.js"></script>
  <script type="text/javascript" src="../../src/backend.dataproxy.js"></script>
  <script type="text/javascript" src="../../src/backend.gdocs.js"></script>
  <script type="text/javascript" src="../../src/backend.elasticsearch.js"></script>
  <script type="text/javascript" src="../../src/backend.csv.js"></script>
  <script type="text/javascript" src="../../src/backend.jsonp.js"></script>

  <!-- views -->
  <script type="text/javascript" src="../../src/view.grid.js"></script>
  <script type="text/javascript" src="../../src/view.slickgrid.js"></script>
  <script type="text/javascript" src="../../src/view.transform.js"></script>
  <script type="text/javascript" src="../../src/view.graph.js"></script>
  <script type="text/javascript" src="../../src/view.map.js"></script>
  <script type="text/javascript" src="../../src/view.timeline.js"></script>
  <script type="text/javascript" src="../../src/view.multiview.js"></script>
  <script type="text/javascript" src="../../src/view.nvd3.graph.js"></script>
  <script type="text/javascript" src="../../src/view.indicator.js"></script>

  <script type="text/javascript" src="../../src/view.kartograph.js"></script>

  <script type="text/javascript" src="../../src/d3/view.d3.table.js"></script>
  <script type="text/javascript" src="../../src/d3/view.d3.sparkline.js"></script>
  <script type="text/javascript" src="../../src/d3/view.d3.treemap.js"></script>

  <script type="text/javascript" src="../../src/view.rickshaw.js"></script>

  <script type="text/javascript" src="../../src/data.transform.js"></script>
  <script type="text/javascript" src="../../src/data.aggregations.js"></script>
  <script type="text/javascript" src="../../src/data.formatters.js"></script>
  <script type="text/javascript" src="../../src/data.filters.js"></script>
  <script type="text/javascript" src="../../src/data.colors.js"></script>
  <script type="text/javascript" src="../../src/data.shapes.js"></script>
  <script type="text/javascript" src="../../src/data.statemanagement.js"></script>
  <script type="text/javascript" src="../../src/data.fieldsutilities.js"></script>

  <script type="text/javascript" src="../../src/widget.pager.js"></script>
  <script type="text/javascript" src="../../src/widget.queryeditor.js"></script>
  <script type="text/javascript" src="../../src/widget.filtereditor.js"></script>
  <script type="text/javascript" src="../../src/widget.fields.js"></script>
  <script type="text/javascript" src="../../src/widget.genericfilter.js"></script>
  <script type="text/javascript" src="../../src/widget.facetviewer.js"></script>
  <script type="text/javascript" src="../../src/widget.currentfilter.js"></script>

  <script type="text/javascript" src="../../src/action.js"></script>

  <script type="text/javascript" src="../../src/template.shapes.js"></script>


    <script type="text/javascript" src="../../vendor/bootstrap/2.1.1/js/bootstrap.js"></script>
<link rel="stylesheet" href="../../vendor/bootstrap/2.1.1/css/moda/bootstrap.css" />

    <link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.ie.css" />
<![endif]-->
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.css">
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.ie.css" />
<![endif]-->

 <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>


  <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet.markercluster/leaflet.markercluster.js"></script>


      <link rel="stylesheet" href="../../vendor/slickgrid/2.0.2/slick.grid.css">


  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/jquery.event.drag-2.0.min.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.core.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.editors.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.formatters.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellrangeselector.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.rowselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>



    
        <!-- raphael -->
<script type="text/javascript" src="../../vendor/raphael/2.1.0/raphael-min.js"></script>
        <!-- kartograph -->
<script type="text/javascript" src="../../vendor/kartograph/unversioned/kartograph.js"></script>


    <link rel="stylesheet" href="../../vendor/rickshaw/1.1.2/rickshaw.min.css">
<script type="text/javascript" src="../../vendor/rickshaw/1.1.2/rickshaw.min.js"></script>

        <!--
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Class.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Compat.ClassList.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Area.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Line.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Bar.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.ScatterPlot.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.RangeSlider.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.HoverDetail.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Annotate.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Legend.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Toggle.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Order.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Highlight.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Smoother.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Unstacker.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Number.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.RandomData.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Color.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Color.Palette.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Y.js"></script>
        -->


   
    <script type="text/javascript" src="../../vendor/chosen/chosen.jquery.min.js"></script>
<link rel="stylesheet" href="../../vendor/chosen/chosen.css" />





</head>
<body>


<div id="loadingImage" style="display:none">
	<div style="position:absolute;top:45%;left:45%;width:150px;height:80px;border:1px solid grey;background-color: #E0E0E0;color: black;z-index:100">
		<p class="centered">
			Loading...
			<br>
			<img  src="../../images/ajax-loader.gif" >
		</p>
	</div>
</div>
<div id="container" class="container-fluid" style="height:100%">
    <div class="row-fluid h5">
		<div class="span12">
			<div id="filterToolbar"></div>
		</div>
    </div>
    <div class="row-fluid h95">
        <div class="span2 ">
            <div class="row-fluid">
                <div id="search_container4"></div>
            </div>
            <div class="row-fluid">
                <div id="search_container4b"></div>
            </div>
            <div class="row-fluid">
                <div id="search_container1"></div>
            </div>
            <div class="row-fluid">
                <div id="search_container"></div>
            </div>
            <div class="row-fluid">
                <div id="search_container3"></div>
            </div>
            <div class="row-fluid">
                <div id="search_container2"></div>
            </div>
        </div>
        <div class="span9 h100">
            <div class="row-fluid h10">
                <div class="span6">
					<div id="indicator1"></div>
                </div>
                <div class="span6">
					<div id="indicator2"></div>
                </div>
            </div>
            <div class="row-fluid h30">
                <div class="span12 h100">
                    <div id="mygrid" style="overflow:auto"></div>
                </div>
            </div>
            <!-- div class="row-fluid" style="height:20%">
                <div class="span12" >
                    <table class="table table-striped table-hover table-condensed">
                    	<thead>
                    		<th>Age</th>
                    		<th>Views</th>
                    		<th>Revenues</th>
                    	</thead>
                    	<tbody>
                    		<tr>
                    			<td>15</td>
                    			<td>12086</td>
                    			<td>12202.69</td>
                    		</tr>
                    		<tr>
                    			<td>20</td>
                    			<td>107975</td>
                    			<td>113041.87</td>
                    		</tr>
                    		<tr>
                    			<td>25</td>
                    			<td>23618</td>
                    			<td>48845</td>
                    		</tr>
                    	</tbody>
                    </table>
                </div>
            </div-->
            <div class="row-fluid h30" >
                <div class="span12"><div id="mygraph2"></div></div>
            </div>
            <div class="row-fluid h30">
                <div class="span6" ><div id="mygraph3"></div></div>
                <div class="span6" ><div id="mygraph4"></div></div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function() {
        var url = "http://192.168.100.133:8380/cwwh-iwal-war/cw/wh/ds/AudDemoByGender";
        //var url = "http://localhost:4000/demos/virtualmodel/AudDemo.json";


        colorSchemaMF = new recline.Data.ColorSchema({   
            type: "scaleWithDistinctData",   
            colors: ['#00CED1', '#1E90FF'], //["DarkTurquoise", "DodgerBlue"]   
        	data:  ["Female", "Male"]
        });
        
        colorSchemaAge = new recline.Data.ColorSchema({   
            type: "scaleWithDataMinMax",   
            colors: ['#000000', '0000FF'],   
        	data:  [0, 100]
        });
        
        dataset = new recline.Model.Dataset({
            url: url,
            backend: 'jsonp',
            id: "AudDemoByGender",
            fieldLabels: [{id: "age", label: "Age (bin)"}, {id: "gender", label: "Gender"}],
            inMemoryQueryFields: ["age", "gender"],
            useMemoryStore: true,
            colorSchema: [ {schema: colorSchemaMF, field: "gender"} ]
        });
        
   		dataset.bind('query:start', function() { document.getElementById("loadingImage").style.display = "block"; });

           virtualdatasetAge = new recline.Model.VirtualDataset({
                dataset: dataset,
                aggregation: {
                    dimensions: ["age"],
                    aggregatedFields: ["totalviewed", "price_sum"],
                    partitions: ["gender"],
                    aggregationFunctions: ["sum", "avg"]
                },
			    totals: {
			        aggregationFunctions:   ["sum"],
			        aggregatedFields:       ["totalviewed_sum", "price_sum_sum"]
			    },
                colorSchema: [ {schema: colorSchemaAge, field: "age"} ]
            });

        dataset.queryState.addFacetNoEvent("age");
        dataset.queryState.addFacetNoEvent("daydate");
        virtualdatasetAge.queryState.addFacetNoEvent("daydate");

   		virtualdatasetWeekday= new recline.Model.VirtualDataset({
                dataset: dataset,
                aggregation: {
                    dimensions: ["dayofweek"],
                    aggregatedFields: ["totalviewed"],
                    partitions: ["gender"],
                    aggregationFunctions: ["sum", "avg"]
                }
            });
            virtualdatasetHour= new recline.Model.VirtualDataset({
                dataset: dataset,
                aggregation: {
                    dimensions: ["dayhour"],
                    aggregatedFields: ["totalviewed"],
                    partitions: ["gender"],
                    aggregationFunctions: ["sum", "avg"]
                }
            });
            virtualdatasetTotal= new recline.Model.VirtualDataset({
				dataset: dataset,
				    aggregation: {
				    aggregatedFields: ["totalviewed", "price_sum"],
				    aggregationFunctions: ["sum"]
				}
            });

            virtualdatasetDay= new recline.Model.VirtualDataset({
                dataset: dataset,
                aggregation: {
                    dimensions: ["daydate"],
                    aggregatedFields: ["totalviewed", "price_sum"],
                    partitions: ["gender"],
                    aggregationFunctions: ["sum", "avg"]
                }
            });
            virtualdatasetDay.queryState.attributes.sort = [{field:"daydate"}];

            virtualdatasetDay.bind('query:done query:fail', function() { document.getElementById("loadingImage").style.display = "none"; });



		var action_db = new recline.Action({
            filters: {
                filter_daydate: {type: "range", field: "daydate", fieldType: "date"}
            },
            models: [
                {model: dataset, filters:["filter_daydate"]}
            ],
            type: ["filter"]
        });
		
		var action_db2 = new recline.Action({
            filters: {
                filter_gender: {type: "list", field: "gender", fieldType: "string"}
            },
            models: [
                {model: dataset, filters:["filter_gender"]}
            ],
            type: ["filter"]
        });
		
		var action_vmodel = new recline.Action({
            filters: {
                filter_age:     {type: "list",  field: "age", fieldType: "number"}
            },
            models: [
                {model: virtualdatasetAge, filters:["filter_age"]}
            ],
            type: ["selection"]
        });

		var dateFilter = {field: "daydate", type: "range", start:new Date(2012,0,01,00,00,00,0), stop:new Date(2012,0,30,00,00,00,0), fieldType: "date" };
        dataset.queryState.addFilter(dateFilter);
        dataset.queryState.addSelection(dateFilter);

        virtualdatasetAge.queryState.addFacetNoEvent("age");
    	dataset.queryState.addFacetNoEvent("gender");

   		dataset.fetch(); // needed to populate filter list
		
   		
           var $el = $('#mygrid');
		   var grid = new recline.View.SlickGrid(
											{model: virtualdatasetAge, el: $el, 
												state: {
													fitColumns:true,
  													useHoverStyle: true,
  													useStripedStyle: true,
  													useCondensedStyle: true,
  													showLineNumbers: true,
													visibleColumns: ['totalviewed_sum', 'price_sum_sum', 'age', 'inner_chart'],
													columnsOrder: ['age', 'totalviewed_sum', 'price_sum_sum', 'innerChart'],
 													useInnerChart:true, 
 													innerChartSerie1:'totalviewed_by_gender_Male_sum', 
 													innerChartSerie2:'totalviewed_by_gender_Female_sum', 
 													innerChartHeader:'Views by Gender',
													fieldLabels: [{id: "totalviewed_sum", label: "Views"}, {id: "price_sum_sum", label: "Revenues"}],
													showTotals: [{field: 'totalviewed_sum', aggregation: 'sum', filtered: false}, {field:'price_sum_sum', aggregation: 'sum', filtered: false}]
												},
												actions : [{
													action : action_vmodel,
													mapping : [{
														srcField : "age",
														filter : "filter_age"
													}],
													event : ["selection"] 
												}]
											}); 
            grid.visible = true;
            grid.render();






		   // $el = $('#mygrid2');
		   // var grid2 = new recline.View.SlickGrid(
											// {model: dataset, el: $el, 
												// state: {
											// fitColumns:true,
												// }
											// }); 
            // grid2.visible = true;
            // grid2.render();


            var graph2 = new recline.View.NVD3Graph({
                model: virtualdatasetDay,
                state: {
                    group: "daydate",
					yLabel: "Total Viewed",
                    series: {type: "byPartitionedField", aggregatedField: "totalviewed", aggregationFunctions: ["sum"]},
                    graphType: "lineChart"
                }
            });
            $('#mygraph2').append(graph2.el);



            var graph3 = new recline.View.NVD3Graph({
                model: virtualdatasetWeekday,
                useFilteredData: false,
                state: {
                    group: "dayofweek",
					yLabel: "Total Viewed AVG",
                    //series: {type: "byFieldName", valuesField: ["totalviewed_by_gender_Male_avg", "totalviewed_by_gender_Female_avg"]},
                    series: {type: "byPartitionedField", aggregatedField: "totalviewed", aggregationFunctions: ["avg"]},
                    graphType: "multiBarChart"
                }
            });
            $('#mygraph3').append(graph3.el);




            var graph4 = new recline.View.NVD3Graph({
                model: virtualdatasetHour,
                state: {
                    group: "dayhour",
					yLabel: "Total Viewed AVG",
                    series: {type: "byPartitionedField", aggregatedField: "totalviewed", aggregationFunctions: ["avg"]},
                    //series: {type: "byFieldName", valuesField: ["totalviewed_by_gender_Male_avg", "totalviewed_by_gender_Female_avg"]},
                    graphType: "multiBarChart"
                }
            })
            $('#mygraph4').append(graph4.el);

            var indicator1 = new recline.View.Indicator({
                state: {
                    kpi:            {dataset: virtualdatasetTotal, type: "filtered", field: "totalviewed_sum"},
					label:"Views"
                }
            });
            $('#indicator1').append(indicator1.el);

            var indicator2 = new recline.View.Indicator({
                state: {
                    kpi:            {dataset: virtualdatasetTotal, type: "filtered", field: "price_sum_sum"},
                    label:"Views"
                }
            });
            $('#indicator2').append(indicator2.el);

			var filter = new recline.View.GenericFilter({
                sourceDataset: dataset,
				sourceFields: [{field: "daydate", controlType: 'range_calendar', type: "range", fieldType: "date" }],
 				state: {title:"DB date filter", description: "Use this to filter dates on the DB"},
                actions: [{
                    action: action_db,
                    mapping: [
                        {srcField: "daydate", filter: "filter_daydate"}
                    ],
                    event: ["selection"]
                }]
            });
            $('#search_container').append(filter.el);

            var filter1 = new recline.View.GenericFilter({
                sourceDataset: dataset,
				sourceFields: [
				               {field: 'daydate', type: "range", controlType: 'month_week_calendar', fieldType: 'date', label:'DATE'},
								{field: 'daydate', controlType: 'dropdown_date_range', fieldType: 'date', label: "Default date ranges"},
								{field: 'daydate', controlType: 'dropdown_date_range', fieldType: 'date', label: "Custom date ranges",
				            	   skipDefaultFilters: true, userFilters: [
				            	                                  			{ label: 'First 15 days of month', start: "1", delta:{days:15}},
				            	                                   			{ label: 'Final 15 days of month', start: "15", delta:{days:15}},
				            	                                           ]   
								},
				               ],
 				state: {title:"DB date filter 2", description: "Use this to filter months/weeks on the DB"},
                actions: [{
                    action: action_db,
                    mapping: [
                        {srcField: "daydate", filter: "filter_daydate"}
                    ],
                    event: ["selection"] 
                }]
            });
            $('#search_container1').append(filter1.el);

            var filter2 = new recline.View.GenericFilter({
                sourceDataset: virtualdatasetAge,
				sourceFields: [
								{field: 'age', controlType: 'list', fieldType: 'number', label:"Set desired age"}
							],
				useFilteredData : false,
                actions: [{
                    action: action_vmodel,
                    mapping: [
                        {srcField: "age", filter: "filter_age"}
                    ],
                    event: ["selection"]
                }]
            });
            $('#search_container2').append(filter2.el);

             var filter3 = new recline.View.GenericFilter({
                 sourceDataset: dataset,
 				sourceFields: [
 								{field: 'gender', controlType: 'legend', fieldType: 'string'}
 							],
 				useFilteredData : false,
 				state: {title:"My gender legend", description: "Lorem ipsum dolor sit amet, consectetur adipiscing elit"},
                 actions: [{
                     action: action_db2,
                     mapping: [
                         {srcField: "gender", filter: "filter_gender"}
                     ],
                     event: ["filter"]
                 }]
             });
             $('#search_container3').append(filter3.el);

            var filter4 = new recline.View.GenericFilter({
                sourceDataset: dataset,
				sourceFields: [
								{field: 'gender', controlType: 'color_legend', fieldType: 'string'}
							],
				useFilteredData : false
            });
            $('#search_container4').append(filter4.el);

            var filter4b = new recline.View.GenericFilter({
                sourceDataset: virtualdatasetAge,
				sourceFields: [
								{field: 'age', controlType: 'color_legend', fieldType: 'number'}
							],
				useFilteredData : false
            });
            $('#search_container4b').append(filter4b.el);


             var filter5 = new recline.View.GenericFilter({
                 sourceDataset: virtualdatasetAge,
                 state: {useHorizontalLayout: true, title:"Horiz toolbar", description: "Select age/gender"},
 				sourceFields: [
 								//{field: 'age', controlType: 'multibutton', fieldType: 'number', labelPosition: "left"},
 								{field: 'age', controlType: 'radiobuttons', fieldType: 'number', labelPosition: "left"},
 								{field: 'age', controlType: 'dropdown_styled', fieldType: 'number', labelPosition: "inside", label: "Select age"},
 								{field: 'age', controlType: 'listbox_styled', fieldType: 'number', labelPosition: "left"},
 								//{field: 'age', controlType: 'range_slider', fieldType: 'number', labelPosition: "left"},
 								{field: 'age', controlType: 'range_slider_styled', fieldType: 'number', labelPosition: "left"},
 							],
 				useFilteredData : false,
                actions: [{
                    action: action_vmodel,
                    mapping: [
                        {srcField: "age", filter: "filter_age"}
                    ],
                    event: ["selection"]
                }]
             });
             $('#filterToolbar').append(filter5.el);
             
            // var facet = new recline.View.FacetViewer({
				// model: virtualdatasetAge
			// });
            // $('#facet_container').append(facet.el);
 	});


</script>


</body>
</html>
