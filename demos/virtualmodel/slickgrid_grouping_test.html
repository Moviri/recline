<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SlickGrid partitioned</title>

    <script type="text/javascript" src="../../vendor/jquery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="../../vendor/jquery/jquery.1.2.1.ba-bbq.min.js"></script>
<script type="text/javascript" src="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.js"></script>


<link type="text/css" href="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.css" rel="stylesheet" />

<script type="text/javascript" src="../../vendor/jquery-slider/js/jquery.slider.js"></script>
<link type="text/css" href="../../vendor/jquery-slider/css/jquery.slider.min.css" rel="stylesheet" />


    
<!-- NVD3 & D3 libraries -->
<script type="text/javascript" src="../../vendor/d3/v2/d3.v2.min.js"></script>

<link rel="stylesheet" href="../../vendor/nvd3/0.0.1/nv.d3.css">

<script type="text/javascript" src="../../vendor/nvd3/0.0.1/nv.d3.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/tooltip.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/utils.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/legend.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/axis.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/scatter.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/line.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/lineChart.js"></script>


<!--<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/nv.d3.min.js"></script>-->

<!--
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/tooltip.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/utils.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/legend.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/axis.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/scatter.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/line.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/lineChart.js"></script>


-->

    

<script type="text/javascript" src="../../vendor/underscore/1.3.3/underscore.js"></script>
<script type="text/javascript" src="../../vendor/backbone/0.9.2/backbone.js"></script>
<script type="text/javascript" src="../../vendor/mustache/0.5.0-dev/mustache.js"></script>


<script type="text/javascript" src="../../vendor/moment/1.6.2/moment.js"></script>
<script type="text/javascript" src="../../vendor/crossfilter/1.1.0/crossfilter.min.js"></script>
<script type="text/javascript" src="../../vendor/kartograph/unversioned/chroma.min.js"></script>

<script type="text/javascript" src="../../vendor/date/date.js"></script>

<!--
    ## Just use the all in one library version rather than individual files

  <script type="text/javascript" src="../../dist/recline.js"></script>

  -->

  <!-- model and backends -->
  <script type="text/javascript" src="../../src/model.js"></script>
  <script type="text/javascript" src="../../src/extensions/model/virtualmodel.js"></script>


  <script type="text/javascript" src="../../src/backend.memory.js"></script>
  <script type="text/javascript" src="../../src/backend.dataproxy.js"></script>
  <script type="text/javascript" src="../../src/backend.gdocs.js"></script>
  <script type="text/javascript" src="../../src/backend.elasticsearch.js"></script>
  <script type="text/javascript" src="../../src/backend.csv.js"></script>
  <script type="text/javascript" src="../../src/extensions/backend/backend.jsonp.js"></script>

  <!-- views -->
  <script type="text/javascript" src="../../src/view.grid.js"></script>
  <script type="text/javascript" src="../../src/view.slickgrid.js"></script>
  <script type="text/javascript" src="../../src/view.transform.js"></script>
  <script type="text/javascript" src="../../src/view.graph.js"></script>
  <script type="text/javascript" src="../../src/view.map.js"></script>
  <script type="text/javascript" src="../../src/view.timeline.js"></script>
  <script type="text/javascript" src="../../src/view.multiview.js"></script>
  <script type="text/javascript" src="../../src/extensions/views/view.nvd3.graph.js"></script>
  <script type="text/javascript" src="../../src/extensions/views/view.indicator.js"></script>

  <script type="text/javascript" src="../../src/extensions/views/view.kartograph.js"></script>

  <script type="text/javascript" src="../../src/extensions/views/d3/view.d3.table.js"></script>
  <script type="text/javascript" src="../../src/extensions/views/d3/view.d3.sparkline.js"></script>
  <script type="text/javascript" src="../../src/extensions/views/d3/view.d3.treemap.js"></script>

  <script type="text/javascript" src="../../src/extensions/views/view.rickshaw.js"></script>

  <script type="text/javascript" src="../../src/data.transform.js"></script>
  <script type="text/javascript" src="../../src/data.aggregations.js"></script>
  <script type="text/javascript" src="../../src/data.formatters.js"></script>
  <script type="text/javascript" src="../../src/extensions/data/data.filters.js"></script>
  <script type="text/javascript" src="../../src/extensions/data/data.colors.js"></script>
  <script type="text/javascript" src="../../src/extensions/data/data.shapes.js"></script>
  <script type="text/javascript" src="../../src/data.statemanagement.js"></script>
  <script type="text/javascript" src="../../src/data.fieldsutilities.js"></script>

  <script type="text/javascript" src="../../src/widget.pager.js"></script>
  <script type="text/javascript" src="../../src/widget.queryeditor.js"></script>
  <script type="text/javascript" src="../../src/widget.filtereditor.js"></script>
  <script type="text/javascript" src="../../src/widget.fields.js"></script>
  <script type="text/javascript" src="../../src/extensions/views/widget.genericfilter.js"></script>
  <script type="text/javascript" src="../../src/widget.facetviewer.js"></script>
  <script type="text/javascript" src="../../src/widget.currentfilter.js"></script>

  <script type="text/javascript" src="../../src/extensions/data/action.js"></script>

  <script type="text/javascript" src="../../src/template.shapes.js"></script>


    <script type="text/javascript" src="../../vendor/bootstrap/2.1.1/js/bootstrap.js"></script>
<link rel="stylesheet" href="../../vendor/bootstrap/2.1.1/css/moda/bootstrap.css" />

    <link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.ie.css" />
<![endif]-->
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.css">
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.ie.css" />
<![endif]-->

 <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>


  <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet.markercluster/leaflet.markercluster.js"></script>


      <link rel="stylesheet" href="../../vendor/slickgrid/2.0.2/slick.grid.css">


  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/jquery.event.drag-2.0.min.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.core.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.editors.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.formatters.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellrangeselector.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.rowselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>

    <script type="text/javascript" src="../../vendor/chosen/chosen.jquery.min.js"></script>
<link rel="stylesheet" href="../../vendor/chosen/chosen.css" />





</head>

<body xmlns="http://www.w3.org/1999/html">

<div class="container-fluid">

    <div class="row-fluid">
        <div class="span3" style="border:1px solid black">
            <div id="grid1" style="height:1100px"></div>
        </div>
         <div class="span9">
		    <div class="row-fluid">
		        <div class="span12" style="border:1px solid black">
		            <div id="grid2" style="height:400px"></div>
		        </div>
	        </div>
		    <div class="row-fluid">
		        <div class="span12" style="border:1px solid black">
		            <div id="grid3" style="height:450px"></div>
		        </div>
	        </div>
	     </div>
    </div>
</div>

<script>

var agebin = function (value, field, record) {
    var v = record.attributes["age"];
	var v0 = Math.floor(v/20);
    return v0*20+"-"+((v0+1)*20-1);
}

var dataset = new recline.Model.Dataset({
    records:[
        {id:1, gender:"Female", age:10, x:20, y:200, date:new Date(2012, 9, 1, 9, 0, 0, 0)},
        {id:2, gender:"Female", age:10, x:25, y:150, date:new Date(2012, 9, 2, 10, 0, 0, 0)},
        {id:3, gender:"Male", age:15, x:30, y:120, date:new Date(2012, 9, 3, 11, 0, 0, 0)},
        {id:4, gender:"Female", age:20, x:40, y:130, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:5, gender:"Male", age:25, x:10, y:340, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:6, gender:"Female", age:30, x:20, y:210, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:7, gender:"Female", age:35, x:25, y:320, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:8, gender:"Male", age:40, x:42, y:460, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:9, gender:"Female", age:45, x:43, y:410, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:10, gender:"Male", age:50, x:40, y:420, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:11, gender:"Female", age:55, x:45, y:440, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:12, gender:"Male", age:60, x:33, y:230, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:13, gender:"Female", age:65, x:22, y:150, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:14, gender:"Female", age:70, x:28, y:250, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:15, gender:"Female", age:75, x:16, y:350, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:16, gender:"Female", age:80, x:12, y:430, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:17, gender:"Female", age:85, x:32, y:250, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:18, gender:"Female", age:90, x:45, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:19, gender:"Female", age:95, x:56, y:150, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:20, gender:"Male", age:15, x:30, y:400, date:new Date(2012, 9, 3, 11, 0, 0, 0)},
        {id:21, gender:"Female", age:20, x:20, y:500, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:22, gender:"Male", age:25, x:10, y:150, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:23, gender:"Female", age:30, x:50, y:250, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:24, gender:"Female", age:35, x:21, y:350, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:25, gender:"Male", age:40, x:32, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:26, gender:"Female", age:45, x:13, y:440, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:27, gender:"Male", age:50, x:23, y:430, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:28, gender:"Female", age:55, x:34, y:420, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:29, gender:"Male", age:60, x:41, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:30, gender:"Female", age:65, x:43, y:140, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:31, gender:"Female", age:70, x:45, y:160, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:32, gender:"Female", age:75, x:47, y:230, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:33, gender:"Female", age:80, x:41, y:260, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:34, gender:"Female", age:85, x:31, y:270, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:35, gender:"Female", age:90, x:37, y:340, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:36, gender:"Female", age:95, x:26, y:210, date:new Date(2012, 9, 4, 12, 0, 0, 0)}
    ],
    fields:[
        {id:'agebin', type:'string', deriver:agebin},
        {id:'age', type:"integer"} ,
        {id:'gender', type:"string"},
        {id:'x', type:"integer"},
        {id:'y', type:"integer"},
        {id:'date', type:"date"},
    ],
});

var virtual1 = new recline.Model.VirtualDataset(
        {
            dataset: dataset,
            aggregation: {
                dimensions:             ["gender"],
                measures:               ["x","y"],
                aggregationFunctions:   ["sum"],
                partitions:             ["agebin"]
            },
            totals: {
                measures:               ["x_sum", "y_sum"],
                aggregationFunctions:   ["sum"]
            }
});

var $el = $('#grid1');
var grid1 = new recline.View.SlickGrid({
    model:dataset,
    el:$el,
    state:{
        fitColumns:true,
        useHoverStyle:true,
        useStripedStyle:true,
        useCondensedStyle:true,
        showLineNumbers: true
    }
});
grid1.visible = true;
grid1.render();

$el = $('#grid2');
var grid2 = new recline.View.SlickGrid({
    model:virtual1,
    el:$el,
    state:{
        fitColumns:true,
        useHoverStyle:true,
        useStripedStyle:true,
        useCondensedStyle:true,
    }
});
grid2.visible = true;
grid2.render();

$el = $('#grid3');
var grid3 = new recline.View.SlickGrid({
    model:virtual1,
    el:$el,
    state:{
        fitColumns:true,
        useHoverStyle:true,
        useStripedStyle:true,
        useCondensedStyle:true,
 		showPartitionedData: {
         	measures:               [{field: "x", aggregation: "sum" }, {field: "y", aggregation: "sum" }],
         	partition:             "agebin",
         	showSubTotals: true
         },
        showTotals: [ {field: "x_sum", aggregation: "sum" }, {field: "y_sum", aggregation: "sum" } ]
    }
});
grid3.visible = true;
grid3.render();


dataset.fetch();
</script>

</body>
</html>

