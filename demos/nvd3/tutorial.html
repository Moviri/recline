<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Demos - NVD3 Integration - Recline Data Explorer and Library</title>

    <script type="text/javascript" src="../../vendor/jquery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="../../vendor/jquery/jquery.1.2.1.ba-bbq.min.js"></script>
<script type="text/javascript" src="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.js"></script>


<link type="text/css" href="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.css" rel="stylesheet" />

<script type="text/javascript" src="../../vendor/jquery-slider/js/jquery.slider.js"></script>
<link type="text/css" href="../../vendor/jquery-slider/css/jquery.slider.min.css" rel="stylesheet" />


    
<!-- NVD3 & D3 libraries -->
<script type="text/javascript" src="../../vendor/d3/v2/d3.v2.min.js"></script>

<link rel="stylesheet" href="../../vendor/nvd3/0.0.1/nv.d3.css">

<script type="text/javascript" src="../../vendor/nvd3/0.0.1/nv.d3.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/tooltip.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/utils.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/legend.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/axis.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/scatter.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/line.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/lineChart.js"></script>


<!--<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/nv.d3.min.js"></script>-->

<!--
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/tooltip.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/utils.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/legend.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/axis.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/scatter.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/line.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/lineChart.js"></script>


-->

    

<script type="text/javascript" src="../../vendor/underscore/1.3.3/underscore.js"></script>
<script type="text/javascript" src="../../vendor/backbone/0.9.2/backbone.js"></script>
<script type="text/javascript" src="../../vendor/mustache/0.5.0-dev/mustache.js"></script>


<script type="text/javascript" src="../../vendor/moment/1.6.2/moment.js"></script>
<script type="text/javascript" src="../../vendor/crossfilter/1.1.0/crossfilter.min.js"></script>
<script type="text/javascript" src="../../vendor/chroma.js/chroma.min.js"></script>

<script type="text/javascript" src="../../vendor/date/date.js"></script>

<!--
    ## Just use the all in one library version rather than individual files

  <script type="text/javascript" src="../../dist/recline.js"></script>

  -->

  <!-- model and backends -->
  <script type="text/javascript" src="../../src/model.js"></script>


  <script type="text/javascript" src="../../src/backend.memory.js"></script>
  <script type="text/javascript" src="../../src/backend.dataproxy.js"></script>
  <script type="text/javascript" src="../../src/backend.gdocs.js"></script>
  <script type="text/javascript" src="../../src/backend.elasticsearch.js"></script>
  <script type="text/javascript" src="../../src/backend.csv.js"></script>
  <script type="text/javascript" src="../../src/backend.jsonp.js"></script>

  <!-- views -->
  <script type="text/javascript" src="../../src/view.grid.js"></script>
  <script type="text/javascript" src="../../src/view.slickgrid.js"></script>
  <script type="text/javascript" src="../../src/view.transform.js"></script>
  <script type="text/javascript" src="../../src/view.graph.js"></script>
  <script type="text/javascript" src="../../src/view.map.js"></script>
  <script type="text/javascript" src="../../src/view.timeline.js"></script>
  <script type="text/javascript" src="../../src/view.multiview.js"></script>






  <script type="text/javascript" src="../../src/data.transform.js"></script>
  <script type="text/javascript" src="../../src/data.aggregations.js"></script>
  <script type="text/javascript" src="../../src/data.formatters.js"></script>
  <script type="text/javascript" src="../../src/data.filters.js"></script>

  <script type="text/javascript" src="../../src/data.statemanagement.js"></script>
  <script type="text/javascript" src="../../src/data.fieldsutilities.js"></script>
  <script type="text/javascript" src="../../src/data.faceting.js"></script>

  <script type="text/javascript" src="../../src/widget.pager.js"></script>
  <script type="text/javascript" src="../../src/widget.queryeditor.js"></script>
  <script type="text/javascript" src="../../src/widget.filtereditor.js"></script>
  <script type="text/javascript" src="../../src/widget.fields.js"></script>
  <script type="text/javascript" src="../../src/widget.genericfilter.js"></script>
  <script type="text/javascript" src="../../src/widget.facetviewer.js"></script>
  <script type="text/javascript" src="../../src/widget.currentfilter.js"></script>
  <script type="text/javascript" src="../../src/widget.datepicker.js"></script>

  <script type="text/javascript" src="../../src/action.js"></script>

  <script type="text/javascript" src="../../src/template.shapes.js"></script>


   <!-- extensions -->

<script type="text/javascript" src="../../src/extensions/model/model.extensions.colors.js"></script>
<script type="text/javascript" src="../../src/extensions/model/model.extensions.shapes.js"></script>
<script type="text/javascript" src="../../src/extensions/model/model.extensions.customfilter.js"></script>

<script type="text/javascript" src="../../src/extensions/data/data.colors.js"></script>
<script type="text/javascript" src="../../src/extensions/data/data.shapes.js"></script>

<script type="text/javascript" src="../../src/extensions/model/virtualmodel.js"></script>
<script type="text/javascript" src="../../src/extensions/model/filteredmodel.js"></script>
<script type="text/javascript" src="../../src/extensions/model/joinedmodel.js"></script>

 <script type="text/javascript" src="../../src/extensions/views/view.indicator.js"></script>

 <script type="text/javascript" src="../../src/extensions/views/view.kartograph.js"></script>
 <script type="text/javascript" src="../../src/extensions/views/view.composed.js"></script>
 <script type="text/javascript" src="../../src/extensions/views/view.rickshaw.js"></script>
 <script type="text/javascript" src="../../src/extensions/views/view.nvd3.graph.js"></script>

<script type="text/javascript" src="../../src/extensions/views/d3/view.d3.table.js"></script>
<script type="text/javascript" src="../../src/extensions/views/d3/view.d3.sparkline.js"></script>
<script type="text/javascript" src="../../src/extensions/views/d3/view.d3.treemap.js"></script>
<script type="text/javascript" src="../../src/extensions/views/d3/view.d3.bullet.js"></script>

    <script type="text/javascript" src="../../vendor/bootstrap/2.1.1/js/bootstrap.js"></script>
<link rel="stylesheet" href="../../vendor/bootstrap/2.1.1/css/moda/bootstrap.css" />

    <link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.ie.css" />
<![endif]-->
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.css">
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.ie.css" />
<![endif]-->

 <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>


  <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet.markercluster/leaflet.markercluster.js"></script>


      <link rel="stylesheet" href="../../vendor/slickgrid/2.0.2/slick.grid.css">


  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/jquery.event.drag-2.0.min.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.core.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.editors.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.formatters.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellrangeselector.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.rowselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>



    
        <!-- raphael -->
<script type="text/javascript" src="../../vendor/raphael/2.1.0/raphael-min.js"></script>
        <!-- kartograph -->
<script type="text/javascript" src="../../vendor/kartograph/unversioned/kartograph.js"></script>


    <link rel="stylesheet" href="../../vendor/rickshaw/1.1.2/rickshaw.min.css">
<script type="text/javascript" src="../../vendor/rickshaw/1.1.2/rickshaw.min.js"></script>

        <!--
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Class.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Compat.ClassList.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Area.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Line.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Bar.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.ScatterPlot.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.RangeSlider.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.HoverDetail.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Annotate.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Legend.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Toggle.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Order.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Highlight.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Smoother.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Unstacker.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Number.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.RandomData.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Color.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Color.Palette.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Y.js"></script>
        -->


   
    <script type="text/javascript" src="../../vendor/chosen/chosen.jquery.min.js"></script>
<link rel="stylesheet" href="../../vendor/chosen/chosen.css" />

    <script type="text/javascript" src="../../vendor/datepicker/1.0.0/js/datepicker.js"></script>
<script type="text/javascript" src="../../vendor/datepicker/1.0.0/js/DateRange.js"></script>
<script type="text/javascript" src="../../vendor/datepicker/1.0.0/js/DateRangesWidget.js"></script>

<link rel="stylesheet" type="text/css" href="../../vendor/datepicker/1.0.0/css/datepicker/base.css" />
<link rel="stylesheet" type="text/css" href="../../vendor/datepicker/1.0.0/css/DateRangesWidget/base.css" />





</head>
<body>


<body>

<div class="container-fluid">



    <div class="row-fluid">
        <div class="span4"> Graph Type <select id="s1" onChange="reDraw();">
            <option value="multiBarChart">multiBarChart</option>
            <option value="pieChart">pieChart</option>
            <option value="lineWithFocusChart">lineWithFocusChart</option>
            <option value="cumulativeLineChart">cumulativeLineChart</option>
            <option value="linePlusBarChart">linePlusBarChart</option>
            <option value="multiBarHorizontalChart">multiBarHorizontalChart</option>
            <option value="discreteBarChart">discreteBarChart (events)</option>
            <option value="stackedAreaChart">stackedAreaChart</option>
            <option value="scatterChart">scatterChart</option>
            <option value="indentedTree">NOT IMPL-indentedTree</option>
            <option value="bulletChart">bulletChart</option>
            <option value="lineChart">lineChart</option>
            <option value="historicalBar">historicalBar</option>
            <option value="legend">legend</option>
            <option value="line">line</option>
            <option value="multiChart">multiChart</option>
            <option value="sparkline">sparkline</option>
            <option value="sparklinePlus">sparklinePlus</option>

            <option value="lineWithBrushChart">MOV-lineWithBrushChart (events)</option>
            <option value="multiBarWithBrushChart">MOV-multiBarWithBrushChart (events)</option>

        </select>
        </div>


    </div>


    <div class="row-fluid">
        <div class="span4">One Series - selection on single column enabled (term)</div>
    </div>
    <div class="row-fluid">
        <div class="span4">
            <div id="grid1" style="height: 200px;"></div>
        </div>
        <div class="span5">
            <div id="graph1" style="height: 200px;"></div>
        </div>
        <div class="span2">
            <div>
                graph1 = new recline.View.NVD3Graph({
                model: dataset,
                state: {
                group: ["x"],
                series: {type: "byFieldName", valuesField: ["y"], sizeField: "z"},
                options: {trendlines:true, minmax: true, tooltips: true, tooltip: "Key: {key} X: {x} Y: {y}",
                staggerLabels: true, showValues: true},
                graphType: type
                },
                actions: [{ action: action1, mapping: [ {srcField: "x", filter: "filter_x"} ], event: ["selection"] }]
                });
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span4">Multiple Series without partition, series name known before rendering, selection on data
            range enabled (brush graph types)
        </div>
    </div>
    <div class="row-fluid">
        <div class="span4">
            <div id="grid2" style="height: 200px;"></div>
        </div>
        <div class="span5">
            <div id="graph2" style="height: 200px;"></div>
        </div>
        <div class="span2">
            <div>
                state: {
                group: ["x"],
                series: {type: "byFieldName", valuesField: ["y", "z"]},
                graphType: "multiBarChart",
                id: "2"
                }
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span4">Multiple Series based on field value</div>
    </div>
    <div class="row-fluid">
        <div class="span4">
            <div id="grid3" style="height: 200px;"></div>
        </div>
        <div class="span5">
            <div id="graph3" style="height: 200px;"></div>
        </div>
        <div class="span2">
            <div>state: {
                group: ["x"],
                series: {type: "byFieldValue", seriesField: "gender", valuesField: "y", fillEmptyValuesWith: 0},
                graphType: "multiBarChart",
                id: "3"
                }
            </div>
        </div>

    </div>

    <div class="row-fluid">
        <div class="span4">Multiple Series based on partition</div>
    </div>
    <div class="row-fluid">
        <div class="span4">
            <div id="grid4" style="height: 200px;">1</div>
        </div>
        <div class="span5">
            <div class="span4"> Group <select id="s2" onChange="changeDimensions();">
                <option value="x">x</option>
                <option value="age">age</option>
            </select>
            </div>
            <div id="graph4" style="height: 200px;">2</div>
        </div>
        <div class="span2">
            <div>
                state: {
                group: ["x"],
                series: {type: "byPartitionedField", aggregatedField: "y", aggregationFunctions: ["sum"],
                fillEmptyValuesWith: 0},
                graphType: "multiBarChart",
                id: "4"
                }
            </div>
        </div>
    </div>


</div>

<script>


var colorSchema = new recline.Data.ColorSchema({
    type:"scaleWithDataMinMax",
    colors:["#0000FF", "#FFF000"]
});

var colorSchemaGender = new recline.Data.ColorSchema({
    type:"scaleWithDistinctData",
    colors:['#F7E1C5', '#6A000B']
});

var shapeSchemaGender = new recline.Data.ShapeSchema({
    shapes:['circle', 'diamond', 'square', 'triangle-down', 'triangle-up']
});

var dataset = new recline.Model.Dataset({
    records:[
        {id:1, gender:"F", age:10, x:20, y:200, z:250},
        {id:2, gender:"F", age:10, x:25, y:300, z:350},
        {id:3, gender:"M", age:15, x:30, y:400, z:450},
        {id:4, gender:"F", age:15, x:40, y:450, z:520}
    ],
    fields:[
        {id:'gender'},
        {id:'x', type:"integer"},
        {id:'y', type:"integer"},
        {id:'z', type:"integer"},
        {id:'age'}
    ]
});
colorSchema.setDataset(dataset, "y");
colorSchemaGender.setDataset(dataset, "gender");
shapeSchemaGender.setDataset(dataset, "gender");

vdatasetGender = new recline.Model.VirtualDataset({
    dataset:dataset,
    aggregation:{
        dimensions:["x"],
        measures:["y", "z"],
        partitions:["gender"],
        aggregationFunctions:["sum", "avg"]
    },
    fieldLabelForPartitions:"{originalField}_by_{partitionFieldName}_{partitionFieldValue}_{aggregatedFunction}"

});

var action1 = new recline.Action({
    filters:{
        filter_x_range:{type:"range", field:"x", fieldType:"integer"},
        filter_x:{type:"term", field:"x", fieldType:"integer"},
        filter_x_list:{type:"list", field:"x", fieldType:"integer"}
    },
    models:[
        {model:dataset, filters:["filter_x", "filter_x_list", "filter_x_range"]}
    ],
    type:["selection"]
});

var $el = $('#grid1');
var grid1 = new recline.View.SlickGrid({
    model:dataset,
    el:$el,
    state:{  fitColumns:true },
    actions:[
                {action:action1, mapping:[
                {srcField:"x", filter:"filter_x_list"}
        ], event:["selection"]  }
    ]
});
grid1.visible = true;
grid1.render();

/*var grid1 = new recline.View.d3.table({
 model : dataset,
 columns : [
 {"name":"x","fields": [{"id":"x"}], "label": "x", "sortable": true, "width": "20%"},
 {"name":"y","fields": [{"id":"y"}], "label": "y", "sortable": true, "width": "20%"},

 ],
 conf : {"row_height": 25, "height": 100},
 state : {
 },
 actions: [{action: action1, mapping: [ {srcField: "x", filter: "filter_x_list"}  ], event: ["hover", "selection"]  }]
 });
 $('#grid1').append(grid1.el);
 */


var $el = $('#grid2');
var grid2 = new recline.View.SlickGrid({
    model:dataset,
    el:$el,
    state:{ fitColumns:true },
    actions:[
        {action:action1, mapping:[
            {srcField:"x", filter:"filter_x_list"}
        ], event:["selection"]  }
    ]
});
grid2.visible = true;
grid2.render();

var $el = $('#grid3');
var grid3 = new recline.View.SlickGrid({
    model:dataset,
    el:$el,
    state:{ fitColumns:true },
    actions:[
        {action:action1, mapping:[
            {srcField:"x", filter:"filter_x_list"}
        ], event:["selection"]  }
    ]
});
grid3.visible = true;
grid3.render();

var $el = $('#grid4');
var grid4 = new recline.View.SlickGrid({
    model:vdatasetGender,
    el:$el,
    state:{ fitColumns:true },
    actions:[
        {action:action1, mapping:[
            {srcField:"x", filter:"filter_x_list"}
        ], event:["selection"]  }
    ]
});
grid4.visible = true;
grid4.render();

var graph1;
var graph2;
var graph3;
var graph4;


drawGraph();

dataset.fetch();

<!-- one serie -->
function reDraw() {
    var type = getSelectedText("s1");
    var graphs = [graph1, graph2, graph3, graph4];

    _.each(graphs, function (d) {
        d.state.attributes.graphType = type;
        d.render();
        d.redraw();
    });


}
;

function changeDimensions() {
    var type = getSelectedText("s2");
    var dataset = [vdatasetGender];

    _.each(dataset, function (d) {
        d.setDimensions([type]);
    });


}
;

function drawGraph() {
    var type = "multiBarChart";


    //stackedAreaData


    graph1 = new recline.View.NVD3Graph({
        model:dataset,
        state:{
            group:["x"],
            series:{type:"byFieldName", valuesField:["y"], sizeField:"z"},
            options:{trendlines:true, minmax:true, tooltips:true, tooltip:"Key: {key} X: {x} Y: {y}", staggerLabels:true, showValues:true},
            graphType:type
        },
        actions:[
            {  action:action1, mapping:[
                {srcField:"x", filter:"filter_x"}
            ], event:["selection"]  }
        ]
    });
    $('#graph1').append(graph1.el);


    <!-- multiple series simple (without partitioning) -->

    graph2 = new recline.View.NVD3Graph({
        model:dataset,
        state:{
            group:["x"],
            series:{type:"byFieldName", valuesField:["y", "z"], sizeField:"z"},
            graphType:type
        },
        actions:[
            {  action:action1, mapping:[
                {srcField:"x", filter:"filter_x"}
            ], event:["selection"]  }
        ]
    });
    $('#graph2').append(graph2.el);


    <!-- multiple series based on field value (without partitioning) -->

    graph3 = new recline.View.NVD3Graph({
        model:dataset,
        state:{
            group:["x"],
            series:{type:"byFieldValue", seriesField:"gender", valuesField:"y", fillEmptyValuesWith:0, sizeField:"z"},
            graphType:type
        }
    });
    $('#graph3').append(graph3.el);


    <!-- multiple series based on partitioned field -->

    graph4 = new recline.View.NVD3Graph({
        model:vdatasetGender,
        state:{
            group:["x"],
            series:{type:"byPartitionedField", aggregatedField:"y", aggregationFunctions:["sum"], fillEmptyValuesWith:0, sizeField:"z_sum"},
            graphType:type
        }
    });
    $('#graph4').append(graph4.el);


}

function getSelectedText(element) {
    var elt = document.getElementById(element);

    if (elt.selectedIndex == -1)
        return null;

    return elt.options[elt.selectedIndex].value;
}


//             series: {type: "byFieldValue", fieldName: "gender", fieldValue: "y"},

</script>

</body>




</body>
</html>
