<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Demos - NVD3 Integration</title>

    <script type="text/javascript" src="../../vendor/jquery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="../../vendor/jquery/jquery.1.2.1.ba-bbq.min.js"></script>
<script type="text/javascript" src="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.js"></script>


<link type="text/css" href="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.css" rel="stylesheet" />

<script type="text/javascript" src="../../vendor/jquery-slider/js/jquery.slider.js"></script>
<link type="text/css" href="../../vendor/jquery-slider/css/jquery.slider.min.css" rel="stylesheet" />


    
<!-- NVD3 & D3 libraries -->
<script type="text/javascript" src="../../vendor/d3/v2/d3.v2.min.js"></script>

<link rel="stylesheet" href="../../vendor/nvd3/0.0.1/nv.d3.css">

<script type="text/javascript" src="../../vendor/nvd3/0.0.1/nv.d3.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/tooltip.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/utils.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/legend.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/axis.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/scatter.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/line.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/lineChart.js"></script>


<!--<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/nv.d3.min.js"></script>-->

<!--
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/tooltip.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/utils.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/legend.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/axis.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/scatter.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/line.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/lineChart.js"></script>


-->

    

<script type="text/javascript" src="../../vendor/underscore/1.3.3/underscore.js"></script>
<script type="text/javascript" src="../../vendor/backbone/0.9.2/backbone.js"></script>
<script type="text/javascript" src="../../vendor/mustache/0.5.0-dev/mustache.js"></script>


<script type="text/javascript" src="../../vendor/moment/1.6.2/moment.js"></script>
<script type="text/javascript" src="../../vendor/crossfilter/1.1.0/crossfilter.min.js"></script>
<script type="text/javascript" src="../../vendor/kartograph/unversioned/chroma.min.js"></script>


<script type="text/javascript" src="../..//dist/recline.dataset.js"></script>
<script type="text/javascript" src="../..//dist/recline.js"></script>

    <script type="text/javascript" src="../../vendor/bootstrap/2.1.1/js/bootstrap.js"></script>
<link rel="stylesheet" href="../../vendor/bootstrap/2.1.1/css/moda/bootstrap.css" />

    <link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.ie.css" />
<![endif]-->
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.css">
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.ie.css" />
<![endif]-->

 <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>


  <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet.markercluster/leaflet.markercluster.js"></script>


      <link rel="stylesheet" href="../../vendor/slickgrid/2.0.2/slick.grid.css">


  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/jquery.event.drag-2.0.min.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.core.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.editors.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.formatters.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellrangeselector.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.rowselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>



    
        <!-- raphael -->
<script type="text/javascript" src="../../vendor/raphael/2.1.0/raphael-min.js"></script>
        <!-- kartograph -->
<script type="text/javascript" src="../../vendor/kartograph/unversioned/kartograph.js"></script>


    <link rel="stylesheet" href="../../vendor/rickshaw/1.1.2/rickshaw.min.css">
<script type="text/javascript" src="../../vendor/rickshaw/1.1.2/rickshaw.min.js"></script>

        <!--
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Class.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Compat.ClassList.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Area.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Line.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Bar.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.ScatterPlot.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.RangeSlider.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.HoverDetail.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Annotate.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Legend.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Toggle.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Order.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Highlight.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Smoother.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Unstacker.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Number.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.RandomData.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Color.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Color.Palette.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Y.js"></script>
        -->


   
    <script type="text/javascript" src="../../vendor/chosen/chosen.jquery.min.js"></script>
<link rel="stylesheet" href="../../vendor/chosen/chosen.css" />


    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-36323657-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>


</head>
<body>


<body xmlns="http://www.w3.org/1999/html">

<div class="container-fluid">


    <div class="row-fluid">
        <div class="span4"></div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <div id="grid1"></div>
        </div>
        <div class="span6">
            <div id="facet1"></div>
        </div>

        <table>
            <tr>
                <td>Current Filters</td>
                <td> <div id="currentfilters"></div></td>
            </tr>
            <tr>
                <td>State</td>
                <td><a id="link" href="#">link</a></td>
            </tr>
            <tr>
                <td>Background</td>
                <td><select id="s1" onChange="redrawBackground();">
                    <option value="select">Select</option>
                    <option value="nobackground">No Background</option>
                    <option value="default">Default</option>
                    <option value="red">Red</option>

                </select></td>
            </tr>
        </table>


    </div>

    <div class="row-fluid">
        <div class="span9">
            <div id="visuals1"></div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span9">
            <div id="horizontal"></div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span9">
            <div id="horizontal2"></div>
        </div>
    </div>


    <div class="row-fluid">
        <div class="span2">
            <table class="table">
                <tr>
                    <td>range_calendar</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter1"></div>
                    </td>
                </tr>
                <tr>
                    <td>list</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter3"></div>
                    </td>
                </tr>

            </table>

        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>month_week_calendar</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter2"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>legend</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter4"></div>
                    </td>
                </tr>
                <tr>
                    <td>dropdown</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter5"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>listbox</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter6"></div>
                    </td>
                </tr>
                <tr>
                    <td>term</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter7"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>range</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter8"></div>
                    </td>
                </tr>
                <tr>
                    <td>slider</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter9"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>range_slider</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter10"></div>
                    </td>
                </tr>
                <tr>
                    <td>legend_color</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter11"></div>
                    </td>
                </tr>

                
            </table>
        </div>
    </div>


</div>

<script>


var initialState = new recline.Data.StateManagement.State({fromQueryString:true});

var colorSchemaDate = new recline.Data.ColorSchema({
    type:"scaleWithDistinctData",
    colors:['#F7E1C5', '#6A000B']
});

var colorSchemaAge = new recline.Data.ColorSchema({
    type:"scaleWithDistinctData",
    colors:['#F7E1C5', '#6A000B']
});

var dataset = new recline.Model.Dataset({
    records:[
        {id:1, gender:"F", age:10, x:20, y:200, date:new Date(2012, 9, 1, 9, 0, 0, 0)},
        {id:2, gender:"F", age:10, x:25, y:300, date:new Date(2012, 9, 2, 10, 0, 0, 0)},
        {id:3, gender:"M", age:15, x:30, y:400, date:new Date(2012, 9, 3, 11, 0, 0, 0)},
        {id:4, gender:"F", age:20, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:5, gender:"F", age:25, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:6, gender:"F", age:30, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:7, gender:"F", age:35, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:8, gender:"F", age:40, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:9, gender:"F", age:45, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:10, gender:"F", age:50, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:11, gender:"F", age:55, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:12, gender:"F", age:60, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:13, gender:"F", age:65, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:14, gender:"F", age:70, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:15, gender:"F", age:75, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:16, gender:"F", age:80, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:17, gender:"F", age:85, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:18, gender:"F", age:90, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)},
        {id:19, gender:"F", age:95, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)}


    ],
    fields:[
        {id:'x', type:"integer"},
        {id:'y', type:"integer"},
        {id:'age', type:"integer"} ,
        {id:'date', type:"date"},
        {id:'gender', type:"string"}
    ],
    initialState:initialState
});
colorSchemaDate.setDataset(dataset, "date");
colorSchemaAge.setDataset(dataset, "age");

dataset.queryState.addFacetNoEvent("age", true);
dataset.queryState.addFacetNoEvent("date", true);


dataset.queryState.bind('change', function () {

    $("#link").attr("href", window.location.origin + window.location.pathname + "?" + recline.Data.StateManagement.getQueryString([dataset]));
});
dataset.queryState.bind('selection:change', function () {

    $("#link").attr("href", window.location.origin + window.location.pathname + "?" + recline.Data.StateManagement.getQueryString([dataset]));
});


var action1 = new recline.Action({
    filters:{
        filter_date_range:{type:"range", field:"date", fieldType:"date"},
        filter_date_term:{type:"term", field:"date", fieldType:"date"},
        filter_date_list:{type:"list", field:"date", fieldType:"date"},
        filter_age_list:{type:"list", field:"age", fieldType:"integer"},
        filter_age_range:{type:"range", field:"age", fieldType:"integer"},
        filter_age_term:{type:"term", field:"age", fieldType:"integer"}
    },
    models:[
        {
            model:dataset,
            filters:["filter_date_term", "filter_date_list", "filter_date_range", "filter_age_list", "filter_age_range", "filter_age_term"]
        }
    ],
    type:["filter"]
});


var $el = $('#grid1');
var grid1 = new recline.View.SlickGrid({
    model:dataset,
    el:$el,
    state:{
        fitColumns:true,
        useHoverStyle:true,
        useStripedStyle:true,
        useCondensedStyle:true
    }
});
grid1.visible = true;
grid1.render();

/*
 var $el = $('#facet1');
 var facet = new recline.View.FacetViewer({
 model: dataset
 });
 facet.render();
 $el.append(facet.el);
 */

var $el = $('#currentfilters');
var currentfilters = new recline.View.CurrentFilter({
    models:[dataset],
    el:$el
});
grid1.render();

var filterhorizontal;

drawGraph();


dataset.fetch();


function drawGraph() {

    var filter1 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'range_calendar', type:"range", fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter1').append(filter1.el);

    var filter2 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'month_week_calendar', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter2').append(filter2.el);

    var filter3 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'list', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter3').append(filter3.el);

    var filter4 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'legend', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter4').append(filter4.el);

    var filter5 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'dropdown', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_term"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter5').append(filter5.el);

    var filter6 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'listbox', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter6').append(filter6.el);

    var filter7 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'term', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_term"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter7').append(filter7.el);

    var filter8 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'range', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter8').append(filter8.el);

    var filter9 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'slider', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_term"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter9').append(filter9.el);


    var filter10 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'range_slider', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter10').append(filter10.el);


    var filter11 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'color_legend', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter11').append(filter11.el);


    filterhorizontal = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'color_legend', fieldType:"integer", label: "Select age", labelPosition: "left"  },
            {field:"age", controlType:'dropdown', fieldType:"integer" , label: "Select age", labelPosition: "left"  },
            {field:"age", controlType:'listbox_styled', fieldType:"integer", label: "Select age", labelPosition: "inside"  },
            {field:"age", controlType:'multibutton', fieldType:"integer", label: "Select age", labelPosition: "none" },


        ],
        state:{
            useHorizontalLayout:true,
            title:"Title",
            description:"Description"
        },
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#horizontal').append(filterhorizontal.el);

    filterhorizontal2 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'range_slider_styled', fieldType:"integer", label: "Select age", labelPosition: "left" },
            {field:"age", controlType:'radiobuttons', fieldType:"integer",  label: "Select age", labelPosition: "yop"   }
     ],
        state:{
            useHorizontalLayout:true,
            title:"Title2",
            description:"Description2"
        },
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#horizontal2').append(filterhorizontal2.el);

}


function redrawBackground() {
    var type = getSelectedText("s1");
    var filter = [filterhorizontal];

    var showBackground = true;
    var backgroundColor;

    if(type == "nobackground") {
        showBackground = false;
    }else if(type =="red") {
        backgroundColor = "#FF0000"
    };


    _.each(filter, function (d) {
        d.options.state["showBackground"] = showBackground;
        if(backgroundColor)
            d.options.state["backgroundColor"] = backgroundColor;
        d.render();
    });
}


function getSelectedText(element) {
    var elt = document.getElementById(element);

    if (elt.selectedIndex == -1)
        return null;

    return elt.options[elt.selectedIndex].value;
}

</script>

</body>




</body>
</html>
