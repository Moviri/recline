<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Demos - NVD3 Integration</title>

    <script type="text/javascript" src="../../vendor/jquery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="../../vendor/jquery/jquery.1.2.1.ba-bbq.min.js"></script>
<script type="text/javascript" src="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.js"></script>


<link type="text/css" href="../../vendor/jQueryUi/jquery-ui-1.8.23.custom.css" rel="stylesheet" />

<script type="text/javascript" src="../../vendor/jquery-slider/js/jquery.slider.js"></script>
<link type="text/css" href="../../vendor/jquery-slider/css/jquery.slider.min.css" rel="stylesheet" />


    
<!-- NVD3 & D3 libraries -->
<script type="text/javascript" src="../../vendor/d3/v2/d3.v2.min.js"></script>

<link rel="stylesheet" href="../../vendor/nvd3/0.0.1/nv.d3.css">

<script type="text/javascript" src="../../vendor/nvd3/0.0.1/nv.d3.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/tooltip.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/utils.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/legend.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/axis.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/scatter.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/line.js"></script>
<script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/lineChart.js"></script>


<!--<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/nv.d3.min.js"></script>-->

<!--
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/tooltip.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/utils.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/legend.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/axis.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/scatter.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/line.js"></script>
<script type="text/javascript" src="https://raw.github.com/Moviri/nvd3/master/src/models/lineChart.js"></script>


-->

    

<script type="text/javascript" src="../../vendor/underscore/1.3.3/underscore.js"></script>
<script type="text/javascript" src="../../vendor/backbone/0.9.2/backbone.js"></script>
<script type="text/javascript" src="../../vendor/mustache/0.5.0-dev/mustache.js"></script>


<script type="text/javascript" src="../../vendor/moment/1.6.2/moment.js"></script>
<script type="text/javascript" src="../../vendor/crossfilter/1.1.0/crossfilter.min.js"></script>
<script type="text/javascript" src="../../vendor/kartograph/unversioned/chroma.min.js"></script>


<script type="text/javascript" src="../..//dist/recline.dataset.js"></script>
<script type="text/javascript" src="../..//dist/recline.js"></script>

    <script type="text/javascript" src="../../vendor/bootstrap/2.1.1/js/bootstrap.js"></script>
<link rel="stylesheet" href="../../vendor/bootstrap/2.1.1/css/moda/bootstrap.css" />

    <link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.ie.css" />
<![endif]-->
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.css">
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.ie.css" />
<![endif]-->

 <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>


  <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet.markercluster/leaflet.markercluster.js"></script>


      <link rel="stylesheet" href="../../vendor/slickgrid/2.0.2/slick.grid.css">


  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/jquery.event.drag-2.0.min.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.core.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.editors.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.formatters.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellrangeselector.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.cellselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.rowselectionmodel.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.2/slick.grid.js"></script>



    
        <!-- raphael -->
<script type="text/javascript" src="../../vendor/raphael/2.1.0/raphael-min.js"></script>
        <!-- kartograph -->
<script type="text/javascript" src="../../vendor/kartograph/unversioned/kartograph.js"></script>


    <link rel="stylesheet" href="../../vendor/rickshaw/1.1.2/rickshaw.min.css">
<script type="text/javascript" src="../../vendor/rickshaw/1.1.2/rickshaw.min.js"></script>

        <!--
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Class.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Compat.ClassList.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Area.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Line.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.Bar.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Renderer.ScatterPlot.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.RangeSlider.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.HoverDetail.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Annotate.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Legend.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Toggle.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Order.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Behavior.Series.Highlight.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Smoother.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Unstacker.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Time.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Number.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.RandomData.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Fixtures.Color.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Color.Palette.js"></script>
<script src="../../vendor/rickshaw/1.1.2/src/Rickshaw.Graph.Axis.Y.js"></script>
        -->


   
    <script type="text/javascript" src="../../vendor/chosen/chosen.jquery.min.js"></script>
<link rel="stylesheet" href="../../vendor/chosen/chosen.css" />


    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-36323657-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>


</head>
<body>


<body>

<div class="container-fluid">
    <style>
    .bs
    {
    position: relative;
    margin: 15px 0;
    padding: 39px 19px 14px;
    background-color: white;
    border: 1px solid #DDD;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    }

    .bs::after
    {
    content: "Indicators";
    position: absolute;
    top: -1px;
    left: -1px;
    padding: 3px 7px;
    font-size: 12px;
    font-weight: bold;
    background-color: whiteSmoke;
    border: 1px solid #DDD;
    color: #9DA0A4;
    -webkit-border-radius: 4px 0 4px 0;
    -moz-border-radius: 4px 0 4px 0;
    border-radius: 4px 0 4px 0;
    }

    .border-free-table td, th {
        border: 0 !important;
    }
</style>

    <div class="row-fluid">
        <div class="span2"><div id="filter1"></div></div>
        <div class="span5"><div id="grid2"  style="height: 30px;"></div><div id="grid1" style="height: 800px;"></div></div>
        <div class="span3">
            <div class="bs">
                  <table class="table">
                      <tr><td><div id="indicator"></div></td><td><div id="indicator2"></div></td></tr>
                      <tr><td><div id="sparkline"></div> </td><td></td></tr>
                   </table>
            </div>


            </div>
    </div>







</div>

<script type="text/javascript" src="../maps/datasource.js"></script>
<script>



var colorSchema = new recline.Data.ColorSchema({
    type: "fixedLimits",
    colors: ['red', 'black'],
    limits: [5000, 10000, 30000]
});

colorSchema.setDataset(dataset, "value");

var shapeSchema = new recline.Data.ShapeSchema({
    type: "fixedLimits",
    shapes:['circle'],
    limits: [5000]
});

vdataset = new recline.Model.VirtualDataset({
    dataset:dataset,
    aggregation:{
        dimensions:["state"],
        aggregatedFields:["value"],
        aggregationFunctions:["sum", "ratioToReport", "runningTotal"]
    },
    totals: {
        aggregationFunctions:   ["sum"],
        aggregatedFields:       ["value_sum"]
    }
});

shapeSchema.setDataset(vdataset, "value_sum_sum", "totals");

var action1 = new recline.Action({
    filters: {
        filter_state_term: {type: "term", field: "state", fieldType: "string"},
        filter_value_range: {type: "range", field: "value_sum", fieldType: "integer"}

    },
    models: [
        {model: vdataset, filters:["filter_state_term", "filter_value_range"]}
    ],
    type: ["filter"]
});

dataset.queryState.addFacetNoEvent("value");

var filter1 = new recline.View.GenericFilter({
    sourceDataset: dataset,
    sourceFields: [{field: "value", controlType: 'range_slider_styled',  fieldType: "integer" }],
    actions: [{
        action: action1,
        mapping: [
            {srcField: "value", filter: "filter_value_range"}
        ],
        event: ["selection"]
    }]
});
$('#filter1').append(filter1.el);

var $el = $('#grid1');
var grid1 = new recline.View.SlickGrid({
    model: vdataset,
    el: $el,
    state: {  fitColumns:true,
        useHoverStyle: true,
        useStripedStyle: true,
        useCondensedStyle: true,
        showTotals: [ {field: "value_sum", aggregation: "sum" } ]
    },
    actions: [{
        action: action1,
        mapping: [
            {srcField: "state", filter: "filter_state_term"}
        ],
        event: ["selection"]
    }]

});
grid1.visible = true;
grid1.render();


var indicator1 = new recline.View.Indicator({
    state: {
        label:"Values 1",
        labelColor: "red",
        description: "show total views",
        descriptionColor: "red",
        textColor: "red",
        kpi:            {dataset: vdataset, type: "totals", field: "value_sum", aggr: "sum"},
        compareWith:    {dataset: vdataset, type: "totals_unfiltered", field: "value_sum", aggr: "sum", compareType: "percentage"}
    }
});
$('#indicator').append(indicator1.el);

var indicator2 = new recline.View.Indicator({
    state: {
        label:          "Values 2",
        kpi:            {dataset: vdataset, type: "totals", field: "value_sum", aggr: "sum"}
    }
});
$('#indicator2').append(indicator2.el);



dataset.fetch();



</script>

</body>




</body>
</html>
